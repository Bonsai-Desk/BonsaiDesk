<!DOCTYPE html>
<html>

<style>
    html,
    body {
        margin: 0;
        padding: 0;
        height: 100%;
    }

    iframe {
        width: 100%;
        height: 100%;
    }
</style>

<body>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>
    <!-- <br>
    <button type="button" onclick="play()">play</button>
    <button type="button" onclick="pause()">pause</button> -->

    <script>
        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                playerVars: {
                    'controls': 0,
                    'disablekb': 1,
                    'enablejsapi': 1,
                    'fs': 0,
                    'iv_load_policy': 3,
                    'modestbranding': 1,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        var timeInterval = null;

        // 4. The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            // var id = "RGuJga2Gl_k";
            // player.cueVideoById(id, 0);
            // player.loadVideoById(id, 0);
        }

        function updateTime() {
            sendMessage("updateTime", player.getCurrentTime());
        }

        function sendMessage(type, message) {
            window.vuplex.postMessage({ type: type, message: message });
        }

        // 5. The API calls this function when the player's state changes.
        function onPlayerStateChange(event) {
            switch (event.data) {
                case YT.PlayerState.UNSTARTED:
                    sendMessage("unstarted", "");
                    break;
                case YT.PlayerState.ENDED:
                    sendMessage("ended", "");
                    clearInterval(timeInterval);
                    timeInterval = null;
                    break;
                case YT.PlayerState.PLAYING:
                    sendMessage("playing", "");
                    if (!timeInterval)
                        timeInterval = setInterval(updateTime, 10000);
                    // sendMessage("videoLength", player.getDuration());
                    break;
                case YT.PlayerState.PAUSED:
                    sendMessage("paused", "");
                    break;
                case YT.PlayerState.BUFFERING:
                    sendMessage("buffering", "");
                    break;
                case YT.PlayerState.CUED:
                    sendMessage("cued", player.getDuration());
                    break;
                default:
                    break;
            }
        }

        function play() {
            //if video is currently paused, or cued
            if ([2, 5].includes(player.getPlayerState())) {
                player.playVideo();
            }
        }
        function pause() {
            //if video is currently playing or buffering
            if ([1, 3].includes(player.getPlayerState())) {
                player.pauseVideo();
            }
        }

        if (window.vuplex) {
            addMessageListener();
        } else {
            window.addEventListener('vuplexready', addMessageListener);
        }

        function addMessageListener() {
            window.vuplex.addEventListener('message', function (event) {

                let json = JSON.parse(event.data);

                if (json.type === "loadVideoById") {
                    player.loadVideoById(json.message, 0);
                }
                else if (json.type === "cueVideoById") {
                    player.cueVideoById(json.message, 0);
                }
                else if (json.type === "startVideo") {
                    play();
                }
                else if (json.type === "pause") {
                    pause();
                }
                else if (json.type === "resume") {
                    play();
                }
                else if (json.type === "stopVideo") {
                    player.stopVideo();
                    clearInterval(timeInterval);
                    timeInterval = null;
                }
                else {
                    // console.log("unknown message type");
                }
            });
        }

    </script>
</body>

</html>