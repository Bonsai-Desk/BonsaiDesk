if(typeof Object.assign!="function"){Object.defineProperty(Object,"assign",{value:function e(t){"use strict";if(t==null){throw new TypeError("Cannot convert undefined or null to object")}var n=Object(t);for(var i=1;i<arguments.length;i++){var o=arguments[i];if(o!=null){for(var r in o){if(Object.prototype.hasOwnProperty.call(o,r)){n[r]=o[r]}}}}return n},writable:true,configurable:true})}var System;(function(e){var a={};var d={};function t(e,t,n){d[e]={deps:t,factory:n}}e.register=t;function n(e,t){a[e]=t}e.registerExternal=n;function c(e){if(e in a)return a[e];return i(e)}e.require=c;function l(e){var t=c(e);return Promise.resolve(t)}function i(e){if(!(e in d))throw new Error("Cannot resolve '"+e+"'");var t=d[e];var n={};a[e]=n;function i(e,t){n[e]=t}var o=t.factory(i,{id:e,import:l});for(var r=0;r<t.deps.length;r++){var s=t.deps[r];o.setters[r](c(s))}o.execute();return n}})(System||(System={}));var __extends=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return i(e,t)};return function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(r,s,a,d){return new(a||(a=Promise))(function(e,t){function n(e){try{o(d.next(e))}catch(e){t(e)}}function i(e){try{o(d["throw"](e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,i)}o((d=d.apply(r,s||[])).next())})};var __generator=this&&this.__generator||function(e,n){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},o,r,s,t;return t={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(t[Symbol.iterator]=function(){return this}),t;function a(t){return function(e){return d([t,e])}}function d(t){if(o)throw new TypeError("Generator is already executing.");while(i)try{if(o=1,r&&(s=t[0]&2?r["return"]:t[0]?r["throw"]||((s=r["return"])&&s.call(r),0):r.next)&&!(s=s.call(r,t[1])).done)return s;if(r=0,s)t=[t[0]&2,s.value];switch(t[0]){case 0:case 1:s=t;break;case 4:i.label++;return{value:t[1],done:false};case 5:i.label++;r=t[1];t=[0];continue;case 7:t=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(t[0]===6||t[0]===2)){i=0;continue}if(t[0]===3&&(!s||t[1]>s[0]&&t[1]<s[3])){i.label=t[1];break}if(t[0]===6&&i.label<s[1]){i.label=s[1];s=t;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(t);break}if(s[2])i.ops.pop();i.trys.pop();continue}t=n.call(e,i)}catch(e){t=[6,e];r=0}finally{o=s=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:true}}};System.register("utils/EventEmitter",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){n=function(){function e(){this._listeners={}}e.prototype.addListener=function(e,t){if(!this._listeners[e]){this._listeners[e]=[]}if(this._listeners[e].indexOf(t)===-1){this._listeners[e].push(t)}};e.prototype.emit=function(t){var e=[];for(var n=1;n<arguments.length;n++){e[n-1]=arguments[n]}if(!this._listeners[t]){return}for(var i=0,o=this._listeners[t];i<o.length;i++){var r=o[i];try{r.apply(void 0,e)}catch(e){console.error("An error occurred while invoking the '"+t+"' event handler.",e)}}};e.prototype.removeListener=function(e,t){if(!this._listeners[e]){return}var n=this._listeners[e].indexOf(t);if(n!==-1){this._listeners[e].splice(n,1)}};return e}();e("default",n)}}});System.register("IBridge",[],function(e,t){"use strict";var n=t&&t.id;return{setters:[],execute:function(){}}});System.register("BaseBridge",["utils/EventEmitter"],function(e,t){"use strict";var n,i;var o=t&&t.id;return{setters:[function(e){n=e}],execute:function(){i=function(){function e(){this._eventEmitter=new n.default;this._eventResponseResolveFunctions={}}e.prototype.addEventListener=function(e,t){this._eventEmitter.addListener(e,t)};e.prototype.removeEventListener=function(e,t){this._eventEmitter.removeListener(e,t)};e.prototype.postMessageWithResponse=function(n){var i=this;var o;do{o=Math.random().toString()}while(o in this._eventResponseResolveFunctions);return new window.Promise(function(e,t){i._eventResponseResolveFunctions[o]=e;n=Object.assign({responseId:o},n);setTimeout(t,1e3);i.postMessage(n)}).then(function(e){delete i._eventResponseResolveFunctions[o];return e}).catch(function(){delete i._eventResponseResolveFunctions[o];throw new Error("The native module didn't respond to the event in time.")})};e.prototype._emit=function(e,t){this._eventEmitter.emit(e,t)};e.prototype._respondToEvent=function(e){var t=e.responseId,n=e.value;var i=this._eventResponseResolveFunctions[t];if(i){i(n)}};return e}();e("default",i)}}});System.register("utils/flattenPrototypes",[],function(e,t){"use strict";var n=t&&t.id;function i(e,t){while(t.constructor.name!=="Object"){for(var n=0,i=Object.getOwnPropertyNames(t);n<i.length;n++){var o=i[n];var r=t[o];if(typeof r==="function"&&o!=="constructor"){e[o]=r.bind(e)}}t=Object.getPrototypeOf(t)}}e("default",i);return{setters:[],execute:function(){}}});System.register("AndroidGeckoBridge",["BaseBridge","utils/flattenPrototypes"],function(e,t){"use strict";var n,i,o,r;var s=t&&t.id;return{setters:[function(e){n=e},function(e){i=e}],execute:function(){o=browser.runtime.connectNative("vuplex.browserAgent");o.onDisconnect.addListener(function(){return console.warn("WebExtension port disconnected")});o.onMessage.addListener(function(e){switch(e.type){case"vuplex.executeJavaScript":var t=e.javaScript;if(e.resultCallbackId){t=t.replace(/`/g,"\\`");t=t.replace(/\${/g,"\\${");t="vuplex.postMessage({\n          type: 'vuplex.webview.javaScriptResult',\n          id: '"+e.resultCallbackId+"',\n          value: (function() {\n            try {\n              // toString() is also needed in order for the string to be serialized correctly\n              return new String(eval(`"+t+"`)).toString();\n            } catch (error) {\n              return new String(error).toString();\n            }\n          })()\n        })"}try{window.Function('"use strict"; '+t)()}catch(e){if(e instanceof window.EvalError){console.warn("The JavaScript from IWebView.ExecuteJavaScript() could not be executed in the page's main JS context because of the page's Content Security Policy, so it will be executed in a separate context. Original error: "+e);Function('"use strict"; '+t)()}else{throw e}}break}});r=function(t){__extends(n,t);function n(){var e=t.call(this)||this;i.default(e,n.prototype);return e}n.prototype.postMessage=function(e){o.postMessage(e)};return n}(n.default);e("default",r)}}});System.register("IframeBridge",["BaseBridge"],function(e,t){"use strict";var n,i;var o=t&&t.id;return{setters:[function(e){n=e}],execute:function(){i=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.postMessage=function(e){};return t}(n.default);e("default",i)}}});System.register("MessageType",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){(function(e){e["ACTIVE_ELEMENT_TYPE_CHANGED"]="ACTIVE_ELEMENT_TYPE_CHANGED";e["AVAILABLE_UPGRADES_REQUEST"]="AVAILABLE_UPGRADES_REQUEST";e["INPUT_DEVICES_REQUEST"]="INPUT_DEVICES_REQUEST";e["INPUT_DEVICES_CHANGED"]="INPUT_DEVICES_CHANGED";e["INITIATE_UPGRADE"]="INITIATE_UPGRADE";e["PAGE_TRANSPARENCY_DETERMINED"]="PAGE_TRANSPARENCY_DETERMINED";e["SCALE_ISSUE_DETECTED"]="vuplex.webview.scaleIssueDetected";e["TITLE_CHANGED"]="vuplex.webview.titleChanged";e["URL_CHANGED"]="vuplex.webview.urlChanged";e["VIDEO_ADDED"]="VIDEO_ADDED";e["VIDEO_CLEAR_SOURCE"]="VIDEO_CLEAR_SOURCE";e["VIDEO_CURRENT_TIME_CHANGED"]="VIDEO_CURRENT_TIME_CHANGED";e["VIDEO_DESTROY_REQUESTED"]="VIDEO_DESTROY_REQUESTED";e["VIDEO_MUTE_CHANGED"]="VIDEO_MUTE_CHANGED";e["VIDEO_PAUSE_REQUESTED"]="VIDEO_PAUSE_REQUESTED";e["VIDEO_PLAYBACK_REQUESTED"]="VIDEO_PLAYBACK_REQUESTED";e["VIDEO_RECT_CHANGED"]="vuplex.webview.videoRectChanged";e["VIDEO_REMOVED"]="VIDEO_REMOVED";e["VIDEO_VOLUME_CHANGED"]="VIDEO_VOLUME_CHANGED";e["CLICK"]="vuplex.webview.click";e["DISPATCH_CHARACTER"]="vuplex.webview.dispatchCharacter";e["HANDLE_KEYBOARD_INPUT"]="vuplex.webview.handleKeyboardInput";e["SCROLL_AT_POINT"]="vuplex.webview.scrollAtPoint";e["IFRAME_UNSCROLLABLE"]="vuplex.webview.iframeUnscrollable"})(n||(n={}));e("default",n)}}});System.register("PostMessageDomain",[],function(e,t){"use strict";var n;var i=t&&t.id;return{setters:[],execute:function(){(function(e){e["VIDEO_MANAGER_EMIT"]="vuplex.videoManagerEmit";e["VIDEO_MANAGER_INVOKE"]="vuplex.videoManagerInvoke";e["IFRAME_BRIDGE_DOWNSTREAM"]="vuplex.iframeBridgeDownstream";e["IFRAME_BRIDGE_UPSTREAM"]="vuplex.iframeBridgeUpstream"})(n||(n={}));e("default",n)}}});System.register("InputManager",["MessageType","PostMessageDomain"],function(e,t){"use strict";var s,a,n;var i=t&&t.id;return{setters:[function(e){s=e},function(e){a=e}],execute:function(){n=function(){function f(){}f.prototype.click=function(e,t){var n=document.elementFromPoint(e,t);if(!n){return}if(n instanceof HTMLIFrameElement&&n.contentWindow){var i=n.getBoundingClientRect();var o=e-i.left;var r=t-i.top;n.contentWindow.postMessage({domain:a.default.IFRAME_BRIDGE_DOWNSTREAM,message:{type:s.default.CLICK,x:o,y:r}},"*");return}this._dispatchPointerEvent(n,"pointermove",e,t);this._dispatchPointerEvent(n,"mousemove",e,t);this._dispatchPointerEvent(n,"pointerover",e,t);this._dispatchPointerEvent(n,"mouseover",e,t);this._dispatchPointerEvent(n,"pointerdown",e,t,1);this._dispatchPointerEvent(n,"mousedown",e,t,1);this._dispatchPointerEvent(n,"click",e,t);if(n instanceof HTMLElement){n.focus()}this._dispatchPointerEvent(n,"pointerup",e,t);this._dispatchPointerEvent(n,"mouseup",e,t)};f.prototype.dispatchCharacter=function(e){if(e==="\n"&&document.activeElement instanceof HTMLInputElement){var t=this._getFocusedForm();if(t){t.submit()}else{this._dispatchKeyPressEvents(document.activeElement,"\r")}return}if(document.activeElement){this._dispatchKeyPressEvents(document.activeElement,e)}if(!f.focusedElementIsEditable){return}var n=document.activeElement;var i=this._getSelection(n),o=i.selectionStart,r=i.selectionEnd;var s=this._getTextValue(n);if(e==="\b"){var a=o===r&&o===0;if(a){return}var d=o!==r;if(d){var c=this._spliceString(s,o,r-o,"");this._setTextValue(n,c);this._setSelection(n,o,o)}else{var c=this._spliceString(s,o-1,1,"");this._setTextValue(n,c);var l=o-1;this._setSelection(n,l,l)}}else if(e==="ArrowLeft"){if(o===r){var u=Math.max(o-1,0);this._setSelection(n,u,u)}else{this._setSelection(n,o,o)}}else if(e==="ArrowRight"){if(o===r){var u=Math.min(r+1,s.length);this._setSelection(n,u,u)}else{this._setSelection(n,r,r)}}else{var c=this._spliceString(s,o,r-o,e);this._setTextValue(n,c);var l=o+1;this._setSelection(n,l,l)}};f.prototype.enableInputTypeWorkaround=function(){setInterval(this._changeActiveInputElementTypeIfNeeded.bind(this),200)};Object.defineProperty(f,"focusedElementIsEditable",{get:function(){var e=document.activeElement;return e&&(this._isInputOrTextarea(e)||e.isContentEditable)},enumerable:true,configurable:true});f.prototype._changeActiveInputElementTypeIfNeeded=function(){var e=document.activeElement;if(e instanceof HTMLInputElement&&(e.type==="email"||e.type==="number")){e.type="text"}};f.prototype._dispatchKeyboardEvent=function(e,t,n){var i=n.charCodeAt(0);var o=new KeyboardEvent(t,{key:n,keyCode:i,bubbles:true});Object.defineProperty(o,"keyCode",{value:i,writable:false});e.dispatchEvent(o)};f.prototype._dispatchKeyPressEvents=function(e,t){this._dispatchKeyboardEvent(e,"keydown",t);this._dispatchKeyboardEvent(e,"keyup",t);this._dispatchKeyboardEvent(e,"keypress",t)};f.prototype._dispatchPointerEvent=function(e,t,n,i,o){if(o===void 0){o=0}var r=new PointerEvent(t,{bubbles:true,cancelable:true,screenX:n,screenY:i,clientX:n,clientY:i,buttons:o,pointerId:1,pointerType:"mouse",isPrimary:true});e.dispatchEvent(r)};f.prototype._getFocusedForm=function(){var e=document.activeElement||null;while(e){if(e instanceof HTMLFormElement){return e}e=e.parentElement}return null};f.prototype._getTextValue=function(e){if(f._isInputOrTextarea(e)){return e.value}return e.innerText||""};f._isInputOrTextarea=function(e){return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement};f.prototype._getSelection=function(e){if(f._isInputOrTextarea(e)){return{selectionStart:e.selectionStart||0,selectionEnd:e.selectionEnd||0}}var t=window.getSelection();if(t&&t.rangeCount){var n=t.getRangeAt(0);if(n.commonAncestorContainer.parentNode==e){return{selectionStart:n.startOffset,selectionEnd:n.endOffset}}}return{selectionStart:0,selectionEnd:0}};f.prototype._setSelection=function(e,t,n){if(f._isInputOrTextarea(e)){e.setSelectionRange(t,n);return}var i=document.createRange();var o=window.getSelection();var r=e.childNodes[0];i.setStart(r,t);i.setStart(r,n);if(o){o.removeAllRanges();o.addRange(i)}};f.prototype._setTextValue=function(e,t){if(e instanceof HTMLInputElement){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").set.call(e,t)}else if(e instanceof HTMLTextAreaElement){Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value").set.call(e,t)}else{e.innerText=t}e.dispatchEvent(new Event("input",{bubbles:true}))};f.prototype._spliceString=function(e,t,n,i){return e.slice(0,t)+i+e.slice(t+Math.abs(n))};return f}();e("default",n)}}});System.register("utils/arrayFrom",[],function(e,t){"use strict";var n=t&&t.id;function i(e){var t=[];for(var n=0;n<e.length;n++){t.push(e[n])}return t}e("default",i);return{setters:[],execute:function(){}}});System.register("showSelectDropdown",["utils/arrayFrom"],function(e,t){"use strict";var E,y;var n=t&&t.id;function I(e,t,n,i,o){var r=document.createElement("vuplex-dropdown-option");r.innerText=e.innerText;Object.assign(r.style,n);r.onclick=function(){t.value=e.value;t.dispatchEvent(new Event("change",{bubbles:true}))};if(o){r.setAttribute("selected","true");var s=function(){r.removeAttribute("selected");i.removeEventListener("mousemove",s)};i.addEventListener("mousemove",s)}return r}function i(g){return __awaiter(this,void 0,void 0,function(){function t(){if(document.body.contains(o)){document.body.removeChild(o)}i.removeEventListener("change",t);i.focus();i.blur()}var i,n,o,r,s,a,d,c,l,u,f,v,p,h,m,_;return __generator(this,function(e){switch(e.label){case 0:i=g.target;n=i.style.display;i.style.display="none";return[4,new Promise(function(e){return setTimeout(e,10)})];case 1:e.sent();i.style.display=n;o=document.createElement("vuplex-dropdown-container");Object.assign(o.style,{position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:2147483648});document.body.appendChild(o);r=document.createElement("style");r.innerText="\n    vuplex-dropdown {\n      position: absolute;\n      background-color: white;\n      display: block;\n      box-shadow: 0 4px 10px rgba(0, 0, 0, .2);\n      border: 1px solid #bcbcbc;\n      z-index: 2147483648; /* max value */\n      max-height: "+y+"px;\n      overflow: scroll;\n      text-align: left;\n    }\n\n    vuplex-dropdown-option {\n      display: block;\n      padding: 6px 10px;\n      color: #1e1e1e;\n      cursor: default;\n    }\n\n    vuplex-dropdown-option:hover {\n      background-color: #1275ff;\n      color: white;\n    }\n\n    vuplex-dropdown-option[selected] {\n      background-color: #1275ff;\n      color: white;\n    }\n  ";o.appendChild(r);o.onclick=t;i.addEventListener("change",t);s=document.createElement("vuplex-dropdown");a=i.getBoundingClientRect();d=navigator.userAgent.indexOf("Firefox")===-1?0:1;s.style.left=a.left-d+"px";s.style.width=a.width+"px";s.style.top=a.top+a.height+"px";o.appendChild(s);c=window.getComputedStyle(i);l=c.font,u=c.fontSize,f=c.fontWeight;v=E.default(i.querySelectorAll("option"));p=v.find(function(e){return e.value===i.value});h={font:l,fontSize:u,fontWeight:f};v.forEach(function(e){var t=e===p;var n=I(e,i,h,s,t);s.appendChild(n);if(t){m=n}});_=s.getBoundingClientRect().height;if(_>y&&m.offsetTop>y){s.scrollTo(0,m.offsetTop)}return[2]}})})}e("default",i);return{setters:[function(e){E=e}],execute:function(){y=300}}});System.register("SelectElementManager",["utils/arrayFrom","showSelectDropdown"],function(e,t){"use strict";var r,s,a,n;var i=t&&t.id;return{setters:[function(e){r=e},function(e){s=e}],execute:function(){a="vuplex";n=function(){function e(){setInterval(this._checkIfSelectElementsWereAddedOrRemoved.bind(this),250)}e.prototype._checkIfSelectElementsWereAddedOrRemoved=function(){var e=document.querySelectorAll("select:not([multiple]):not([disabled])");var t=r.default(e);for(var n=0,i=t;n<i.length;n++){var o=i[n];if(!o.getAttributeNS(a,"managed")){o.setAttributeNS(a,"managed","true");o.addEventListener("click",s.default)}}};return e}();e("default",n)}}});System.register("Rect",[],function(e,t){"use strict";var n=t&&t.id;function i(e,t){var n=e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height;return n}e("rectsAreEqual",i);return{setters:[],execute:function(){}}});System.register("RemoteVideoController",["utils/EventEmitter","MessageType","PostMessageDomain","Rect"],function(e,t){"use strict";var n,o,r,i,s;var a=t&&t.id;return{setters:[function(e){n=e},function(e){o=e},function(e){r=e},function(e){i=e}],execute:function(){s=function(n){__extends(e,n);function e(e){var t=n.call(this)||this;t._lastIframeRect={left:0,top:0,width:0,height:0};t._lastNormalizedIframeVideoRect={left:0,top:0,width:0,height:0};t._videoRect={left:0,top:0,width:0,height:0};t._videoId=e.videoId;t._iframe=e.iframe;t._handlePostedWindowMessage=t._handlePostedWindowMessage.bind(t);window.addEventListener("message",t._handlePostedWindowMessage);t._iframeRectCheckIntervalId=setInterval(t._checkIfIframeRectChanged.bind(t),50);return t}e.prototype.complete=function(){this._proxyToIframe("complete",this._videoId)};e.prototype.destroy=function(){window.removeEventListener("message",this._handlePostedWindowMessage);clearInterval(this._iframeRectCheckIntervalId)};e.prototype.setCurrentTime=function(e){this._proxyToIframe("setCurrentTime",this._videoId,e)};e.prototype.setPlayState=function(e){this._proxyToIframe("setPlayState",this._videoId,e)};Object.defineProperty(e.prototype,"video",{get:function(){return null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"videoId",{get:function(){return this._videoId},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"videoRect",{get:function(){return this._videoRect},enumerable:true,configurable:true});e.prototype._checkIfIframeRectChanged=function(){var e=this._iframe.getBoundingClientRect();if(i.rectsAreEqual(e,this._lastIframeRect)){return}this._lastIframeRect=e;var t=this._convertVideoRect(this._lastNormalizedIframeVideoRect);this.emit("messageEmitted",{type:o.default.VIDEO_RECT_CHANGED,videoId:this._videoId,value:{rect:t}})};e.prototype._handlePostedWindowMessage=function(e){var t=e.data;var n=e.source===this._iframe.contentWindow&&t&&t.domain===r.default.VIDEO_MANAGER_EMIT&&t.message&&t.message.videoId===this._videoId;if(!n){return}if(t.message.type===o.default.VIDEO_RECT_CHANGED){this._lastNormalizedIframeVideoRect=t.message.value.rect;var i=this._convertVideoRect(t.message.value.rect);this._videoRect=i;t.message.value.rect=i}this.emit("messageEmitted",t.message)};e.prototype._convertVideoRect=function(e){var t=this._iframe.getBoundingClientRect();var n={left:e.left*t.width,top:e.top*t.height,width:e.width*t.width,height:e.height*t.height};var i={left:t.left+n.left,top:t.top+n.top,width:n.width,height:n.height};var o={left:i.left/document.documentElement.clientWidth,top:i.top/document.documentElement.clientHeight,width:i.width/document.documentElement.clientWidth,height:i.height/document.documentElement.clientHeight};return o};e.prototype._proxyToIframe=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}try{this._iframe.contentWindow.postMessage({domain:r.default.VIDEO_MANAGER_INVOKE,method:e,args:t},"*")}catch(e){console.warn("proxying a video message to an iframe failed, probably because the iframe was removed")}};return e}(n.default);e("default",s)}}});System.register("RemoteVideoControllerEmitter",["utils/EventEmitter","utils/arrayFrom","MessageType","PostMessageDomain","RemoteVideoController"],function(e,t){"use strict";var n,d,s,a,c,i;var o=t&&t.id;return{setters:[function(e){n=e},function(e){d=e},function(e){s=e},function(e){a=e},function(e){c=e}],execute:function(){i=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e._trackedIframeRecords=[];window.addEventListener("message",e._handlePostedWindowMessage.bind(e));e._checkForRemovedIframes=e._checkForRemovedIframes.bind(e);setInterval(e._checkForRemovedIframes,200);return e}e.prototype._addToTrackedIframes=function(t,e){var n=this._trackedIframeRecords.find(function(e){return e.iframe===t});if(n){n.videoIds.push(e)}else{this._trackedIframeRecords.push({iframe:t,videoIds:[e]})}};e.prototype._checkForRemovedIframes=function(){var s=d.default(document.getElementsByTagName("iframe"));var e=function(e){var t=a._trackedIframeRecords[e];var n=s.find(function(e){return e===t.iframe});if(!n){for(var i=0,o=t.videoIds;i<o.length;i++){var r=o[i];a.emit("videoControllerRemoved",r)}a._trackedIframeRecords.splice(e,1)}};var a=this;for(var t=this._trackedIframeRecords.length-1;t>=0;t--){e(t)}};e.prototype._handlePostedWindowMessage=function(t){var e=t.data;if(!(e&&e.domain===a.default.VIDEO_MANAGER_EMIT&&typeof e.message==="object")){return}switch(e.message.type){case s.default.VIDEO_ADDED:{var n=e.message.videoId;var i=d.default(document.getElementsByTagName("iframe"));var o=i.find(function(e){return e.contentWindow===t.source});if(o){this._addToTrackedIframes(o,n);var r=new c.default({videoId:n,iframe:o});this.emit("videoControllerAdded",r)}break}case s.default.VIDEO_REMOVED:{this._removeFromTrackedIframes(t.source,e.message.videoId);this.emit("videoControllerRemoved",e.message.videoId);break}}};e.prototype._removeFromTrackedIframes=function(t,e){var n=this._trackedIframeRecords.find(function(e){return e.iframe.contentWindow===t});if(!n){console.warn("A remote video was removed, but its iframe is not currently tracked.");return}var i=n.videoIds.indexOf(e);if(i===-1){console.warn("A remote video was removed, but its videoId wasn't included in the list of tracked videoIds")}else{n.videoIds.splice(i,1)}};return e}(n.default);e("default",i)}}});System.register("VideoUserControls",["utils/EventEmitter"],function(e,t){"use strict";var n,s,a,d,c,i;var o=t&&t.id;return{setters:[function(e){n=e}],execute:function(){s="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMzIuMTUzIDIzMi4xNTMiIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIj48cGF0aCBkPSJNMjAzLjc5MSA5OS42MjhMNDkuMzA3IDIuMjk0QzQ0Ljc0LS40MjUgMzkuMDY5LjAyOCAzNC43ODYuMDI4IDE3LjY1NC4wMjggMTcuNzMgMTMuMjU1IDE3LjczIDE2LjYwNnYxOTguOTRjMCAyLjgzMy0uMDc1IDE2LjU3OSAxNy4wNTYgMTYuNTc5IDQuMjgzIDAgOS45NTUuNDUxIDE0LjUyMS0yLjI2N2wxNTQuNDgzLTk3LjMzM2MxMi42OC03LjU0NSAxMC40ODktMTYuNDQ5IDEwLjQ4OS0xNi40NDlzMi4xOTItOC45MDQtMTAuNDg4LTE2LjQ0OHoiIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIi8+PC9zdmc+";a="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0Ny42MDcgNDcuNjA3IiB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiI+PGcgZmlsbD0iI0ZGRiI+PHBhdGggZD0iTTE3Ljk5MSA0MC45NzZhNi42MzEgNi42MzEgMCAwIDEtMTMuMjYyIDBWNi42MzFhNi42MzEgNi42MzEgMCAwIDEgMTMuMjYyIDB2MzQuMzQ1ek00Mi44NzcgNDAuOTc2YTYuNjMxIDYuNjMxIDAgMCAxLTEzLjI2MiAwVjYuNjMxYTYuNjMxIDYuNjMxIDAgMCAxIDEzLjI2MiAwdjM0LjM0NXoiLz48L2c+PC9zdmc+";d="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNDU5IDQ1OSI+PHBhdGggZD0iTTAgMTUzdjE1M2gxMDJsMTI3LjUgMTI3LjV2LTQwOEwxMDIgMTUzSDB6bTM0NC4yNSA3Ni41YzAtNDUuOS0yNS41LTg0LjE1LTYzLjc1LTEwMnYyMDRjMzguMjUtMTcuODUgNjMuNzUtNTYuMSA2My43NS0xMDJ6TTI4MC41IDUuMXY1My41NUMzNTQuNDUgODEuNiA0MDggMTQ3Ljg5OSA0MDggMjI5LjVzLTUzLjU1IDE0Ny45LTEyNy41IDE3MC44NXY1My41NUMzODIuNSA0MzAuOTQ5IDQ1OSAzMzkuMTUgNDU5IDIyOS41UzM4Mi41IDI4LjA0OSAyODAuNSA1LjF6IiBmaWxsPSIjRkZGIi8+PC9zdmc+";c="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNDYxLjU1IDQ2MS41NSI+PHBhdGggZD0iTTM0NS41MjUgMjI5LjVjMC00NS45LTI1LjUtODQuMTUtNjMuNzUtMTAydjU2LjFsNjMuNzUgNjMuNzVWMjI5LjV6bTYzLjc1IDBjMCAyMi45NS01LjEgNDUuOS0xMi43NSA2Ni4zbDM4LjI1IDM4LjI1YzE3Ljg1LTMwLjYgMjUuNS02OC44NSAyNS41LTEwNy4xIDAtMTA5LjY1LTc2LjUtMjAxLjQ1LTE3OC41LTIyNC40VjU2LjFjNzMuOTUgMjUuNSAxMjcuNSA5MS44IDEyNy41IDE3My40ek0zNC40MjUgMEwxLjI3NSAzMy4xNSAxMjEuMTI1IDE1M0gxLjI3NXYxNTNoMTAybDEyNy41IDEyNy41VjI2Mi42NWwxMDkuNjUgMTA5LjY1Yy0xNy44NTEgMTIuNzUtMzUuNyAyMi45NS01OC42NSAzMC42MDF2NTMuNTVjMzUuNy03LjY1IDY2LjMtMjIuOTUgOTQuMzUtNDUuOWw1MSA1MSAzMy4xNS0zMy4xNDktMjI5LjUtMjI5LjVMMzQuNDI1IDB6bTE5Ni4zNSAyNS41bC01My41NSA1My41NSA1My41NSA1My41NVYyNS41eiIgZmlsbD0iI0ZGRiIvPjwvc3ZnPg==";i=function(n){__extends(e,n);function e(e){var t=n.call(this)||this;t._currentTime=0;t._duration=0;t._isPlaying=false;t._muted=false;t._elements={centerPlayIcon:null,currentTime:null,duration:null,mutedIcon:null,pauseIcon:null,playIcon:null,playPauseClickTarget:null,scrubber:null,scrubberProgress:null,unmutedIcon:null};t._handleMutedOrUnmutedClick=t._handleMutedOrUnmutedClick.bind(t);t._handlePlayOrPauseClick=t._handlePlayOrPauseClick.bind(t);t._handleScrubberClick=t._handleScrubberClick.bind(t);t._createControls(e);return t}e.prototype.setCurrentTime=function(e){if(this._currentTime===e){return}this._currentTime=e;this._elements.currentTime.innerText=this._formatPlaybackTime(e);this._updateScrubberProgress()};e.prototype.setDuration=function(e){if(this._duration===e){return}this._duration=e;this._elements.duration.innerText=this._formatPlaybackTime(e);this._updateScrubberProgress()};e.prototype.setMuted=function(e){if(this._muted===e){return}this._muted=e;if(e){this._elements.mutedIcon.style.display="inline-block";this._elements.unmutedIcon.style.display="none"}else{this._elements.mutedIcon.style.display="none";this._elements.unmutedIcon.style.display="inline-block"}};e.prototype.setPlayState=function(e){if(this._isPlaying===e){return}this._isPlaying=e;if(e){this._elements.centerPlayIcon.style.display="none";this._elements.playIcon.style.display="none";this._elements.pauseIcon.style.display="inline-block"}else{this._elements.centerPlayIcon.style.display="block";this._elements.playIcon.style.display="inline-block";this._elements.pauseIcon.style.display="none"}};e.prototype._createControls=function(e){var t=document.createElement("div");t.className="vr-video-controls";Object.assign(t.style,{position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"all"});var n={centerPlayIcon:"",currentTime:"",duration:"",mutedIcon:"",pauseIcon:"",playIcon:"",playPauseClickTarget:"",scrubber:"",scrubberProgress:"",unmutedIcon:""};for(var i in n){n[i]=Math.random().toString()}t.innerHTML='\n      <style>\n        .vr-video-play-pause-click-target {\n          position: absolute; top: 0; right: 0; left: 0;\n          height: calc(100% - 45px);\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n        .vr-video-center-play-icon {\n          width: 40px;\n          cursor: pointer;\n        }\n        .vr-video-center-play-icon img {\n          width: 100%;\n        }\n        .vr-video-control-bar {\n          position: absolute; right: 0; bottom: 0; left: 0;\n          height: 40px;\n        }\n        .vr-video-scrubber {\n          height: 5px;\n          width: 95%;\n          margin: auto;\n          background-color: #a9d6d6;\n          position: relative;\n          cursor: pointer;\n        }\n        .vr-video-scrubber-progress {\n          position: absolute; top: 0; left: 0; bottom: 0;\n          width: 0%;\n          background-color: white;\n        }\n        .vr-video-bottom-controls {\n          height: 35px;\n          display: flex;\n          align-items: center;\n          width: 90%;\n          margin: auto;\n        }\n        .vr-video-control-icon {\n          height: 50%;\n          margin-right: 10px;\n          cursor: pointer;\n        }\n        .vr-video-control-icon img {\n          height: 100%;\n        }\n        .vr-video-times {\n          color: white;\n          font-family: Helvetica, Arial, sans-serif;\n          font-size: 12px;\n        }\n      </style>\n      <div class="vr-video-play-pause-click-target" id="'+n.playPauseClickTarget+'">\n        <div class="vr-video-center-play-icon" id="'+n.centerPlayIcon+'">\n          <img src="'+s+'">\n        </div>\n      </div>\n      <div class="vr-video-control-bar">\n        <div class="vr-video-scrubber" id="'+n.scrubber+'">\n          <div class="vr-video-scrubber-progress" id="'+n.scrubberProgress+'"></div>\n        </div>\n        <div class="vr-video-bottom-controls">\n          <div class="vr-video-control-icon">\n            <img src="'+s+'" id="'+n.playIcon+'">\n            <img src="'+a+'" id="'+n.pauseIcon+'" style="display: none;">\n          </div>\n          <div class="vr-video-control-icon">\n            <img src="'+d+'" id="'+n.unmutedIcon+'">\n            <img src="'+c+'" id="'+n.mutedIcon+'" style="display: none;">\n          </div>\n          <div class="vr-video-times">\n            <span id="'+n.currentTime+'">0:00</span> / <span id="'+n.duration+'">0:00</span>\n          </div>\n        </div>\n      </div>\n    ';e.appendChild(t);for(var i in n){this._elements[i]=document.getElementById(n[i])}var o={mutedIcon:this._handleMutedOrUnmutedClick,playPauseClickTarget:this._handlePlayOrPauseClick,playIcon:this._handlePlayOrPauseClick,pauseIcon:this._handlePlayOrPauseClick,scrubber:this._handleScrubberClick,unmutedIcon:this._handleMutedOrUnmutedClick};for(var r in o)this._elements[r].addEventListener("click",o[r])};e.prototype._formatPlaybackTime=function(e){if(isNaN(Math.floor(e))){return"0:00"}var t=Math.floor(e/3600).toString();var n=Math.floor(e%3600/60).toString();var i=Math.floor(e%3600%60).toString();if(i.length===1){i="0"+i}if(t!=="0"&&n.length===1){n="0"+n}var o=t==="0"?"":t+":";var r=""+o+n+":"+i;return r};e.prototype._handleMutedOrUnmutedClick=function(){var e=!this._muted;this.setMuted(e);var t=e?"mute":"unmute";this.emit(t)};e.prototype._handlePlayOrPauseClick=function(){var e=!this._isPlaying;this.setPlayState(e);var t=e?"play":"pause";this.emit(t)};e.prototype._handleScrubberClick=function(e){var t=this._elements.scrubber.getBoundingClientRect();var n=this._duration*(e.clientX-t.left)/t.width;this.setCurrentTime(n);this.emit("seek",n)};e.prototype._updateScrubberProgress=function(){var e=this._duration?this._currentTime*100/this._duration:0;this._elements.scrubberProgress.style.width=e+"%"};return e}(n.default);e("default",i)}}});System.register("VideoController",["utils/EventEmitter","MessageType","Rect","VideoUserControls"],function(e,t){"use strict";var n,o,i,r,s,a;var d=t&&t.id;return{setters:[function(e){n=e},function(e){o=e},function(e){i=e},function(e){r=e}],execute:function(){(function(e){e["NOT_TRIGGERED_YET"]="NOT_TRIGGERED_YET";e["WAITING_FOR_COMPLETION"]="WAITING_FOR_COMPLETION";e["COMPLETED"]="COMPLETED"})(s||(s={}));a=function(n){__extends(e,n);function e(e){var t=n.call(this)||this;t._currentTime=0;t._initialPlayEventState=s.NOT_TRIGGERED_YET;t._muted=false;t._videoId=Math.random().toString();t._videoRect={left:0,top:0,width:0,height:0};t._videoBackdropRect={left:0,top:0,width:0,height:0};t._volume=1;t.addListener("messageEmitted",e.messageHandler);t._video=e.video;t._handlePlayEvent=t._handlePlayEvent.bind(t);t._handleVideoEnded=t._handleVideoEnded.bind(t);t._video.addEventListener("ended",t._handleVideoEnded);t._checkIfVideoRectChanged=t._checkIfVideoRectChanged.bind(t);t._updateVideoBackdrop=t._updateVideoBackdrop.bind(t);t._patchVideoElementProperties();return t}e.prototype.complete=function(){this._handleVideoEnded();this._video.dispatchEvent(new Event("ended"))};e.prototype.destroy=function(){clearInterval(this._videoRectCheckIntervalId);this.emit("messageEmitted",{type:o.default.VIDEO_DESTROY_REQUESTED,videoId:this._videoId})};Object.defineProperty(e.prototype,"isPlaying",{get:function(){return!this._video.paused},enumerable:true,configurable:true});e.prototype.setCurrentTime=function(e){this._currentTime=e;this._video.dispatchEvent(new Event("timeupdate"));if(this._videoUserControls)this._videoUserControls.setCurrentTime(e)};e.prototype.setPlayState=function(e){if(e){if(this._initialPlayEventState===s.WAITING_FOR_COMPLETION)this._initialPlayEventState=s.COMPLETED;this._video.dispatchEvent(new Event("loadeddata"));this._video.dispatchEvent(new Event("canplay"));this._video.dispatchEvent(new Event("canplaythrough"));this._setPaused(false);this._video.dispatchEvent(Object.assign(new Event("play"),{_triggeredByJavaScript:true}));this._video.dispatchEvent(new Event("playing"))}else{this._video.pause()}};Object.defineProperty(e.prototype,"video",{get:function(){return this._video},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"videoId",{get:function(){return this._videoId},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"videoRect",{get:function(){return this._videoRect},enumerable:true,configurable:true});e.prototype._checkIfVideoRectChanged=function(){var e;var t=this._currentTime&&this._currentTime.toFixed(1)===this._video.duration.toFixed(1);if(t){e={left:0,top:0,width:0,height:0}}else{var n=this._getActualVideoRect();e={left:n.left/document.documentElement.clientWidth,top:n.top/document.documentElement.clientHeight,width:n.width/document.documentElement.clientWidth,height:n.height/document.documentElement.clientHeight}}if(!i.rectsAreEqual(e,this._videoRect)){this._videoRect=e;this.emit("messageEmitted",{type:o.default.VIDEO_RECT_CHANGED,videoId:this._videoId,value:{rect:e}})}};e.prototype._getActualVideoRect=function(){var e=this._video.getBoundingClientRect();var t=e.width/e.height;var n=this._video.videoWidth;var i=this._video.videoHeight;if(!(n&&i)){return e}var o=n/i;if(o===t){return e}var r={left:e.left,top:e.top,width:e.width,height:e.height};if(o>t){r.height=r.width/o;r.top+=(e.height-r.height)/2}else{r.width=r.height*o;r.left+=(e.width-r.width)/2}return r};e.prototype._handlePlayEvent=function(e){if(e._triggeredByJavaScript){return}this._originalPause();this._video.play()};e.prototype._handleVideoEnded=function(){this._setPaused(true);this.setCurrentTime(this._video.duration)};e.prototype._patchVideoElementProperties=function(){var t=this;var e=!this._video.paused;if(!this._video.paused){this._video.pause()}this._video.setAttribute("playsinline","");this._video.setAttribute("webkit-playsinline","");this._video.addEventListener("play",this._handlePlayEvent);this._video.play=function(){if(t._initialPlayEventState===s.WAITING_FOR_COMPLETION){return}if(t._initialPlayEventState===s.NOT_TRIGGERED_YET){t._initialPlayEventState=s.WAITING_FOR_COMPLETION}var e=t._video.getAttribute("stereomode")||"none";if(e!=="top-bottom"){t._videoRectCheckIntervalId=setInterval(t._checkIfVideoRectChanged,50)}t.emit("messageEmitted",{type:o.default.VIDEO_PLAYBACK_REQUESTED,videoUrl:t._videoUrl,videoId:t._videoId,muted:t._muted,loop:t._video.getAttribute("loop")!==null,stereoMode:e})};this._originalPause=this._video.pause.bind(this._video);this._video.pause=function(){if(t._video.paused){return}t._setPaused(true);t._video.dispatchEvent(new Event("pause"));t.emit("messageEmitted",{type:o.default.VIDEO_PAUSE_REQUESTED,videoId:t._videoId})};var n=this._video.removeAttribute.bind(this._video);this._video.removeAttribute=function(e){if(e=="src"&&!t._video.paused){t.emit("messageEmitted",{type:o.default.VIDEO_CLEAR_SOURCE,videoId:t._videoId})}n(e)};Object.defineProperty(this._video,"currentTime",{configurable:true,get:function(){return t._currentTime},set:function(e){if(typeof e!=="number")throw new Error("currentTime must be a number");if(e<0)throw new Error("currentTime must be positive");t.setCurrentTime(e);t.emit("messageEmitted",{type:o.default.VIDEO_CURRENT_TIME_CHANGED,videoId:t._videoId,value:e});t._video.dispatchEvent(new Event("seeking"));t._video.dispatchEvent(new Event("seeked"))}});this._volume=this._video.volume;Object.defineProperty(this._video,"volume",{configurable:true,get:function(){return t._volume},set:function(e){if(typeof e!=="number")throw new Error("volume must be a number");if(e<0||e>1)throw new Error("Failed to set the 'volume' property on 'HTMLMediaElement': The volume provided ("+e+") is outside the range [0, 1].");t._volume=e;t._video.dispatchEvent(new Event("volumechange"));t.emit("messageEmitted",{type:o.default.VIDEO_VOLUME_CHANGED,videoId:t._videoId,value:e})}});this._muted=!!this._video.muted;Object.defineProperty(this._video,"muted",{configurable:true,get:function(){return t._muted},set:function(e){t._muted=!!e;t._video.dispatchEvent(new Event("volumechange"));t.emit("messageEmitted",{type:o.default.VIDEO_MUTE_CHANGED,videoId:t._videoId,value:t._muted});if(t._videoUserControls)t._videoUserControls.setMuted(t._muted)}});this._updateVideoBackdrop();setInterval(this._updateVideoBackdrop,200);var i=this._video.controls;if(i){this._video.controls=false}Object.defineProperty(this._video,"controls",{configurable:true,get:function(){return!!t._videoUserControls},set:function(e){if(e&&!t._videoUserControls){t._videoUserControls=new r.default(t._videoBackdrop);t._videoUserControls.addListener("play",t._video.play.bind(t._video));t._videoUserControls.addListener("pause",t._video.pause.bind(t._video));t._videoUserControls.addListener("seek",function(e){return t._video.currentTime=e});t._videoUserControls.addListener("mute",function(){return t._video.muted=true});t._videoUserControls.addListener("unmute",function(){return t._video.muted=false});t._videoUserControls.setDuration(t._video.duration);t._video.addEventListener("durationchange",function(){if(t._videoUserControls){t._videoUserControls.setDuration(t._video.duration)}});t._videoUserControls.setMuted(t._video.muted)}}});this._video.controls=i;if(e){this._video.play()}};e.prototype._setPaused=function(e){Object.defineProperty(this._video,"paused",{value:e,writable:false,configurable:true});if(this._videoUserControls)this._videoUserControls.setPlayState(!e)};e.prototype._updateVideoBackdrop=function(){if(!(this._videoBackdrop&&document.body.contains(this._videoBackdrop))){this._videoBackdrop=document.createElement("div");this._video.insertAdjacentElement("afterend",this._videoBackdrop);Object.assign(this._videoBackdrop.style,{position:"fixed",backgroundColor:"black",pointerEvents:"none"});this._videoBackdropRect={left:0,top:0,width:0,height:0}}var e=this._video.getBoundingClientRect();if(!i.rectsAreEqual(e,this._videoBackdropRect)){this._videoBackdropRect=e;Object.assign(this._videoBackdrop.style,{width:e.width+"px",height:e.height+"px",top:e.top+"px",right:e.right+"px",bottom:e.bottom+"px",left:e.left+"px"})}};Object.defineProperty(e.prototype,"_videoUrl",{get:function(){var e;if(this._video.src){e=this._video.src}else{var t=this._video.getElementsByTagName("source")[0];e=t&&t.src}if(!e){throw new Error("Video with ID "+this._videoId+" has no src attribute or source tags.")}var n=!(e.indexOf("http://")===0||e.indexOf("https://")===0||e.indexOf("file://")===0);if(n){if(e[0]==="/"){e=location.origin+e}else{var i=e.indexOf("./")===0?e.substr(2):e;var o=location.pathname.split("/").slice(0,-1).join("/");var r=o+"/"+i;e=location.origin+"/"+r}}return e},enumerable:true,configurable:true});return e}(n.default);e("default",a)}}});System.register("VideoManagerIframeBridge",["PostMessageDomain","BaseBridge"],function(e,t){"use strict";var o,n,i;var r=t&&t.id;return{setters:[function(e){o=e},function(e){n=e}],execute:function(){i=function(n){__extends(e,n);function e(e){var t=n.call(this)||this;t._videoManager=e.videoManager;window.addEventListener("message",t._handlePostedWindowMessage.bind(t));return t}e.prototype.postMessage=function(e){parent.postMessage({domain:o.default.VIDEO_MANAGER_EMIT,message:e},"*")};e.prototype._handlePostedWindowMessage=function(e){var t;var n=e.data;if(!(n&&n.domain===o.default.VIDEO_MANAGER_INVOKE)){return}var i=n.args||[];(t=this._videoManager)[n.method].apply(t,i)};return e}(n.default);e("default",i)}}});System.register("VideoManager",["utils/arrayFrom","MessageType","RemoteVideoController","RemoteVideoControllerEmitter","VideoController","VideoManagerIframeBridge"],function(e,t){"use strict";var d,r,c,n,l,i,u,o;var s=t&&t.id;return{setters:[function(e){d=e},function(e){r=e},function(e){c=e},function(e){n=e},function(e){l=e},function(e){i=e}],execute:function(){u="vrdesktop";o=function(){function e(e){this._activeVideoId=null;this._isInIframe=parent!==window;this._remoteVideoControllerEmitter=new n.default;this._videoControllers={};this._bridge=e.bridge;window.MediaSource=undefined;this._handleVideoControllerMessage=this._handleVideoControllerMessage.bind(this);if(this._isInIframe){this._bridge=new i.default({videoManager:this})}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",this._performPostDomLoadInitialization.bind(this))}else{this._performPostDomLoadInitialization()}this._remoteVideoControllerEmitter.addListener("videoControllerAdded",this._addVideoController.bind(this));this._remoteVideoControllerEmitter.addListener("videoControllerRemoved",this._removeVideoController.bind(this));setInterval(this._checkIfVideosWereAddedToOrRemovedFromDom.bind(this),10);this._checkIfVideosWereAddedToOrRemovedFromDom()}e.prototype.complete=function(e){this._getVideo(e).complete()};e.prototype.pauseAll=function(){for(var e=0,t=this._videoControllerValues;e<t.length;e++){var n=t[e];if(n.isPlaying){try{n.setPlayState(false)}catch(e){console.log("An error occurred while pausing a video: "+e.stack)}}}};e.prototype.setCurrentTime=function(e,t){var n=this._videoControllers[e];if(n){n.setCurrentTime(t)}};e.prototype.setPlayState=function(e,t){this._getVideo(e).setPlayState(t)};e.prototype._addVideoController=function(e){e.addListener("messageEmitted",this._handleVideoControllerMessage);this._videoControllers[e.videoId]=e;if(this._isInIframe){this._bridge.postMessage({type:r.default.VIDEO_ADDED,videoId:e.videoId})}};e.prototype._checkIfVideosWereAddedToOrRemovedFromDom=function(){var t=d.default(document.getElementsByTagName("video"));for(var e=0,n=t;e<n.length;e++){var i=n[e];if(!i.getAttributeNS(u,"managed")){var o=new l.default({video:i,messageHandler:this._handleVideoControllerMessage});i.setAttributeNS(u,"managed","true");this._addVideoController(o)}}var r=this._videoControllerValues.filter(function(e){return!(e instanceof c.default)}).filter(function(e){return t.indexOf(e.video)===-1});for(var s=0,a=r;s<a.length;s++){var o=a[s];this._removeVideoController(o.videoId)}};e.prototype._getVideo=function(e){var t=this._videoControllers[e];if(t){return t}throw new Error("No video controller for videoId '"+e+"'.")};e.prototype._handleVideoControllerMessage=function(e){if(this._isInIframe){this._bridge.postMessage(e);return}var t=e.type===r.default.VIDEO_PLAYBACK_REQUESTED;var n=t&&!this._activeVideoId;var i=t&&this._activeVideoId&&e.videoId!==this._activeVideoId;if(n){this._activeVideoId=e.videoId}else if(i){this._bridge.postMessage({type:r.default.VIDEO_PAUSE_REQUESTED,videoId:this._activeVideoId});var o=this._getVideo(e.videoId);this._activeVideoId=e.videoId;this._bridge.postMessage({type:r.default.VIDEO_RECT_CHANGED,videoId:e.videoId,value:{rect:o.videoRect}})}if(this._activeVideoId===e.videoId||e.type===r.default.VIDEO_CURRENT_TIME_CHANGED){this._bridge.postMessage(e)}};e.prototype._performPostDomLoadInitialization=function(){if(!this._isInIframe){this._bridge.postMessage({type:r.default.VIDEO_RECT_CHANGED,value:{rect:{left:0,top:0,width:0,height:0}}})}};e.prototype._removeVideoController=function(e){var t=this._getVideo(e);delete this._videoControllers[e];t.removeListener("messageEmitted",this._handleVideoControllerMessage);t.destroy();if(this._isInIframe){this._bridge.postMessage({type:r.default.VIDEO_REMOVED,videoId:e})}};Object.defineProperty(e.prototype,"_videoControllerValues",{get:function(){var t=this;return Object.keys(this._videoControllers).map(function(e){return t._videoControllers[e]})},enumerable:true,configurable:true});return e}();e("default",o)}}});System.register("BrowserAgent",["utils/EventEmitter","IframeBridge","InputManager","MessageType","PostMessageDomain","SelectElementManager","VideoManager","utils/flattenPrototypes"],function(e,t){"use strict";var n,i,o,m,_,r,a,d,c,l,s;var u=t&&t.id;return{setters:[function(e){n=e},function(e){i=e},function(e){o=e},function(e){m=e},function(e){_=e},function(e){r=e},function(e){a=e},function(e){d=e}],execute:function(){(function(e){e["LOAD"]="LOAD";e["PUSH_STATE"]="PUSH_STATE";e["REPLACE_STATE"]="REPLACE_STATE";e["HASH_CHANGE"]="HASH_CHANGE"})(c||(c={}));(function(e){e["TEXT_INPUT"]="TEXT_INPUT";e["OTHER"]="OTHER"})(l||(l={}));s=function(t){__extends(n,t);function n(e){var s=t.call(this)||this;s._activeElementDuringLastBlur=null;s._activeElementType=l.OTHER;s._consoleApiPatched=false;s._consoleMessageEventsEnabled=false;s._isInIframe=parent!==window;s._title="";s._handleIframeMessage=function(t){if(!t.data){return}var e=t.data.message;if(t.data.domain===_.default.IFRAME_BRIDGE_DOWNSTREAM){switch(e.type){case m.default.CLICK:s.click(e.x,e.y);break;case m.default.DISPATCH_CHARACTER:s.dispatchCharacter(e.character);break;case m.default.HANDLE_KEYBOARD_INPUT:s.handleKeyboardInput(e.input);break;case m.default.SCROLL_AT_POINT:s.scrollAtPoint(e.deltaX,e.deltaY,e.pointerX,e.pointerY);break}}else if(t.data.domain===_.default.IFRAME_BRIDGE_UPSTREAM){if(e.type===m.default.IFRAME_UNSCROLLABLE){var n=Array.from(document.getElementsByTagName("iframe")).find(function(e){return e.contentWindow===t.source});if(!n){return}var i=n.getBoundingClientRect();var o=i.left+e.pointerX;var r=i.top+e.pointerY;s.scrollAtPoint(e.deltaX,e.deltaY,o,r,true)}}};s._consoleMessageEventsEnabled=!!e.enableConsoleMessageEvents;s._patchConsoleApiIfNeeded();d.default(s,n.prototype);window.addEventListener("message",s._handleIframeMessage);if(s._isInIframe){s._bridge=new i.default}else{s._bridge=e.bridge}if(e.enableVideoSupport){s.videoManager=new a.default(e)}s._inputManager=new o.default;s._selectElementManager=new r.default;if(e.enableInputTypeWorkaround){s._inputManager.enableInputTypeWorkaround();setInterval(s._removeAnchorTargetAttributes,1e3)}if(document.readyState==="loading"||!document.head){document.addEventListener("DOMContentLoaded",s._performPostDomLoadInitialization.bind(s))}else{s._performPostDomLoadInitialization()}if(s._isInMainFrame){s._emitUrlChange(c.LOAD);s._watchForUrlChanges()}return s}n.prototype.blur=function(){var e=document.activeElement;this._activeElementDuringLastBlur=e;if(e instanceof HTMLElement){e.blur()}};n.prototype.click=function(e,t){this._inputManager.click(e,t)};n.prototype.dispatchCharacter=function(e){if(document.activeElement instanceof HTMLIFrameElement){document.activeElement.contentWindow.postMessage({domain:_.default.IFRAME_BRIDGE_DOWNSTREAM,message:{type:m.default.DISPATCH_CHARACTER,character:e}},"*");return}this._inputManager.dispatchCharacter(e)};n.prototype.enableClickTest=function(){var e=this;var t=function(){e._clickTestPointerBlocker=document.createElement("div");Object.assign(e._clickTestPointerBlocker.style,{position:"fixed",top:"0",right:"0",bottom:"0",left:"0",zIndex:2147483647});e._clickTestTarget=document.createElement("div");Object.assign(e._clickTestTarget.style,{position:"absolute",top:"0",left:"0",height:"5px",width:"5px"});e._clickTestPointerBlocker.appendChild(e._clickTestTarget);document.body.appendChild(e._clickTestPointerBlocker);e._clickTestTarget.addEventListener("click",function(){e._bridge.postMessage({type:"CLICK_TEST_TARGET_HIT"});document.body.removeChild(e._clickTestPointerBlocker)});e._bridge.postMessage({type:"CLICK_TEST_TARGET_READY"})};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",t)}else{t()}};n.prototype.focus=function(){if(this._activeElementDuringLastBlur instanceof HTMLElement){this._activeElementDuringLastBlur.focus();this._activeElementDuringLastBlur=null}};n.prototype.handleKeyboardInput=function(e){if(document.activeElement instanceof HTMLIFrameElement){document.activeElement.contentWindow.postMessage({domain:_.default.IFRAME_BRIDGE_DOWNSTREAM,message:{type:m.default.HANDLE_KEYBOARD_INPUT,input:e}},"*");return}if(o.default.focusedElementIsEditable&&(e==="ArrowLeft"||e==="ArrowRight")){this.dispatchCharacter(e);return}switch(e){case"ArrowUp":window.scrollBy(0,-50);break;case"ArrowDown":window.scrollBy(0,50);break;case"ArrowLeft":window.scrollBy(-50,0);break;case"ArrowRight":window.scrollBy(50,0);break;case"cmd+ArrowUp":window.scroll(0,0);break;case"cmd+ArrowDown":window.scroll(document.body.scrollHeight,0);break;case"cmd+a":this._selectAll();break}};n.prototype.setDefaultBackgroundIfNeeded=function(){var e=document.body,t=document.documentElement;if(!(e&&t)){return}function n(e){var t=window.getComputedStyle(e);var n=!(!t.background||t.background.indexOf("rgba(0, 0, 0, 0)")===0);var i=!(!t.backgroundColor||t.backgroundColor.indexOf("rgba(0, 0, 0, 0)")===0||t.backgroundColor==="transparent");return n||i}var i=n(document.body)||n(document.documentElement);if(i){return}var o=document.createElement("vuplex-page-background");Object.assign(o.style,{position:"fixed",top:"0",right:"0",bottom:"0",left:"0",backgroundColor:"white",zIndex:"-2147483647"});e.appendChild(o)};n.prototype.scroll=function(e,t){window.scrollBy(e,t)};n.prototype.scrollAtPoint=function(e,t,n,i,o){if(o===void 0){o=false}if(e===0&&t===0){return}var r;var s=false;while(!(r===document.scrollingElement||r instanceof HTMLIFrameElement&&!o||s)){r=r?r.parentElement:document.elementFromPoint(n,i)||document.scrollingElement;if(!r){break}if(Math.abs(t)>Math.abs(e)){var a=false;if(t>0){var d=r.scrollHeight-(r.scrollTop+r.clientHeight);a=d>0}else{var c=r.scrollTop;a=c>0}s=a&&["scroll","auto"].indexOf(window.getComputedStyle(r).overflowY)!==-1}else{var a=false;if(e>0){var l=r.scrollWidth-(r.scrollLeft+r.clientWidth);a=l>0}else{var u=r.scrollLeft;a=u>0}s=a&&["scroll","auto"].indexOf(window.getComputedStyle(r).overflowX)!==-1}}if(r&&r instanceof HTMLIFrameElement&&r.contentWindow&&!o){var f=r.getBoundingClientRect();var v=n-f.left;var p=i-f.top;r.contentWindow.postMessage({domain:_.default.IFRAME_BRIDGE_DOWNSTREAM,message:{type:m.default.SCROLL_AT_POINT,deltaX:e,deltaY:t,pointerX:v,pointerY:p}},"*")}else if(r){var h=parent!==window;if(h&&!s){parent.postMessage({domain:_.default.IFRAME_BRIDGE_UPSTREAM,message:{type:m.default.IFRAME_UNSCROLLABLE,deltaX:e,deltaY:t,pointerX:n,pointerY:i}},"*");return}if(window.getComputedStyle(r).scrollBehavior==="smooth"){r.style.scrollBehavior="auto"}r.scrollTop+=t;r.scrollLeft+=e;if(r===document.body&&document.scrollingElement&&document.scrollingElement!==document.body){document.scrollingElement.scrollTop+=t;document.scrollingElement.scrollLeft+=e}}else{window.scrollBy(e,t)}};n.prototype.setConsoleMessageEventsEnabled=function(e){this._consoleMessageEventsEnabled=e;this._patchConsoleApiIfNeeded()};n.prototype._addViewportMetaTag=function(){var e=document.createElement("meta");e.setAttribute("name","viewport");e.setAttribute("content","viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0");document.head.appendChild(e);if(document.body.clientWidth!==document.body.scrollWidth){var t=[window.innerWidth,document.documentElement.clientWidth,document.documentElement.scrollWidth];var n=t.map(function(e){return e===document.body.scrollWidth}).reduce(function(e,t){return e&&t},true);if(n){this._bridge.postMessage({type:m.default.SCALE_ISSUE_DETECTED})}}};n.prototype._checkActiveElementType=function(){var e=o.default.focusedElementIsEditable?l.TEXT_INPUT:l.OTHER;if(this._activeElementType!==e){this._activeElementType=e;this._bridge.postMessage({type:m.default.ACTIVE_ELEMENT_TYPE_CHANGED,value:e})}};n.prototype._checkForTitleChanges=function(){var e=document.title;if(!e||this._title===e){return}this._title=e;this._bridge.postMessage({type:m.default.TITLE_CHANGED,value:e})};n.prototype._determinePageTransparency=function(){var e=document.head.getElementsByTagName("meta");var t=Array.prototype.filter.call(e,function(e){return e.getAttribute("name")==="transparent"})[0];var n=!!t&&t.getAttribute("content")==="true";this._bridge.postMessage({type:m.default.PAGE_TRANSPARENCY_DETERMINED,value:n})};n.prototype._emitUrlChange=function(e){try{var t=document.URL;if(t.indexOf("chrome-error://")===0){return}if(t.indexOf("about:")===0){return}if(t.indexOf("ms-local-stream://")===0){return}if(t.indexOf(".pdf?file=")!==-1){return}this._bridge.postMessage({type:m.default.URL_CHANGED,urlAction:{Url:t,Title:document.title,Type:e}})}catch(e){console.error("An error occurred while handling the URL change: "+e.name+": "+e.message+"\n"+e.stack)}};Object.defineProperty(n.prototype,"_isInMainFrame",{get:function(){return parent===window},enumerable:true,configurable:true});n.prototype._onHashChange=function(){this._emitUrlChange(c.HASH_CHANGE)};n.prototype._onPushState=function(){this._emitUrlChange(c.PUSH_STATE)};n.prototype._onReplaceState=function(){this._emitUrlChange(c.PUSH_STATE)};n.prototype._patchConsoleApiIfNeeded=function(){if(this._consoleApiPatched||!this._consoleMessageEventsEnabled){return}this._consoleApiPatched=true;this._patchConsoleMethod("log","LOG");this._patchConsoleMethod("info","LOG");this._patchConsoleMethod("debug","DEBUG");this._patchConsoleMethod("error","ERROR");this._patchConsoleMethod("warn","WARNING")};n.prototype._patchConsoleMethod=function(e,i){var o=this;var r=console[e].bind(console);console[e]=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(o._consoleMessageEventsEnabled){try{var n=e.map(function(e){return typeof e==="object"&&!(e instanceof Error)?JSON.stringify(e):e}).join(", ");o._bridge.postMessage({type:"vuplex.webview.consoleMessageLogged",level:i,message:n})}catch(e){}}r.apply(void 0,e)}};n.prototype._performPostDomLoadInitialization=function(){this._addViewportMetaTag();if(this._isInMainFrame){setInterval(this._checkForTitleChanges.bind(this),200);setInterval(this._checkActiveElementType.bind(this),200);this._determinePageTransparency()}};n.prototype._removeAnchorTargetAttributes=function(){var e=document.querySelectorAll("a[target]");e.forEach(function(e){return e.removeAttribute("target")})};n.prototype._selectAll=function(){var e=document.activeElement;if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){e.select()}};n.prototype._watchForUrlChanges=function(){var i=this;var o=history.pushState;history.pushState=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n=o.apply(history,e);i._onPushState();return n};var r=history.replaceState;history.replaceState=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n=r.apply(history,e);i._onReplaceState();return n};window.onhashchange=this._onHashChange.bind(this);window.addEventListener("yt-navigate-finish",this._onPushState.bind(this))};return n}(n.default);e("default",s)}}});System.register("index.android-gecko",["AndroidGeckoBridge","BrowserAgent"],function(e,t){"use strict";var n,i,o,r;var s=t&&t.id;return{setters:[function(e){n=e},function(e){i=e}],execute:function(){o=new n.default;window.wrappedJSObject.vuplex=cloneInto(o,window,{cloneFunctions:true});r=new i.default(Object.assign({bridge:o}));window.wrappedJSObject._VRDesktopBrowserAgent=cloneInto(r,window,{cloneFunctions:true});window.vuplex=o;window._VRDesktopBrowserAgent=r;window.Function("\"use strict\";\n\n// GeckoWebView.java only listens for messages from the main frame.\nconst isInMainFrame = parent === window;\nif (!isInMainFrame) {\n  return;\n}\n\n// GeckoWebView.java sets this to false if console logging is disabled.\nwindow._vuplexConsoleEnabled = true;\n\nfunction patchConsoleMethod(methodName, level) {\n  const originalMethod = window.console[methodName].bind(window.console);\n  window.console[methodName] = (...args) => {\n    if (window._vuplexConsoleEnabled) {\n      try {\n        const message = args.map(arg => typeof arg === 'object' && !(arg instanceof Error) ? JSON.stringify(arg) : arg)\n                            .join(', ');\n        vuplex.postMessage({\n          type: 'vuplex.webview.consoleMessageLogged',\n          level,\n          message\n        });\n      } catch (error) {}\n    }\n    originalMethod(...args);\n  };\n}\npatchConsoleMethod('log', 'LOG');\npatchConsoleMethod('info', 'LOG');\npatchConsoleMethod('debug', 'DEBUG');\npatchConsoleMethod('error', 'ERROR');\npatchConsoleMethod('warn', 'WARNING');\n")();o.postMessage("vuplex.webview.gecko.browserAgentReady");window.dispatchEvent(new Event("vuplexready"))}}});System.require("index.android-gecko");
