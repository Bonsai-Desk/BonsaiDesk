(this.webpackJsonpBonsaiUI=this.webpackJsonpBonsaiUI||[]).push([[0],{119:function(e,t,n){},163:function(e,t,n){"use strict";n.r(t);var c=n(2),o=n(1),s=n.n(o),a=n(33),r=n.n(a),i=(n(87),n(11)),l=n(37),d=n(7),u=n(72),j=-1,b=0,h=1,p=2,f=3,x=5,m=function(e){var t;switch(e){case-1:t="unstarted";break;case 0:t="ended";break;case 1:t="playing";break;case 2:t="paused";break;case 3:t="buffering";break;case 5:t="cued";break;default:t="BAD SWITCH STATE"}return t},O=function(e){var t=new URLSearchParams(e.location.search),n=parseInt(t.get("x")),s=parseInt(t.get("y")),a={width:n&&s?n:window.innerWidth,height:n&&s?s:window.innerHeight,playerVars:{autoplay:0,controls:0,disablekb:1,rel:0}},r=Object(i.g)(),l="youtube_test"===e.location.pathname.split("/")[1],O=e.match.params,g=O.id,v=O.timeStamp,w=Object(o.useState)(null),y=Object(d.a)(w,2),k=y[0],_=y[1],C=Object(o.useState)(!1),N=Object(d.a)(C,2),S=N[0],E=N[1],M=Object(o.useState)(!1),T=Object(d.a)(M,2),D=T[0],L=T[1],J=Object(o.useState)(!1),H=Object(d.a)(J,2),A=H[0],I=H[1],P=Object(o.useState)(!1),R=Object(d.a)(P,2),B=R[0],U=R[1],V=Object(o.useCallback)((function(e){"READY"!==e&&L(!1),console.log("POST "+e),l||window.vuplex.postMessage({type:"stateChange",message:e,current_time:k.getCurrentTime()})}),[k,l]),W=Object(o.useCallback)((function(e){if(null!=k){if(D&&Math.abs(k.getCurrentTime()-e)<.01)return console.log("bonsai: ready-up called while ready"),void V("READY");var t=k.getPlayerState();S?(console.log("bonsai: readying up from "+m(t)+" -> "+e),Y(k),t===p&&k.playVideo(),k.seekTo(e,!0),k.pauseVideo(),k.unMute()):console.log("bonsai: ignoring attempt to ready-up before init")}else console.log("bonsai: ignoring attempt to ready up while player is null")}),[S,k,V,D]),Y=function(e){console.log("bonsai: prepare to ready up"),L(!1),I(!0),e.mute()};Object(o.useEffect)((function(){if(null!=k&&!l){var e=function(e){var t=JSON.parse(e.data);if("video"===t.type)switch(console.log(e.data),t.command){case"play":console.log("COMMAND: play"),k.playVideo();break;case"pause":console.log("COMMAND: pause"),k.pauseVideo();break;case"readyUp":console.log("COMMAND: readyUp"),W(t.timeStamp);break;default:console.log("command: not handled (video) "+e.data)}};return window.vuplex.addEventListener("message",e),function(){window.vuplex.removeEventListener("message",e)}}}),[g,k,l,W]),Object(o.useEffect)((function(){console.log("bonsai: add ping interval");var e=setInterval((function(){var e=0;null!=k&&null!=k.getCurrentTime()&&(e=k.getCurrentTime()),l||window.vuplex.postMessage({type:"infoCurrentTime",current_time:e})}),100);return function(){console.log("bonsai: remove ping interval"),clearInterval(e)}}),[g,k,l]);return Object(c.jsxs)("div",{children:[l?Object(c.jsxs)("div",{children:[Object(c.jsx)("p",{onClick:function(){r.push("/home")},children:"home"})," ",Object(c.jsx)("p",{onClick:function(){W(40)},children:"ready up"})]}):"",Object(c.jsx)(u.a,{opts:a,onReady:function(e){var t=e.target;_(t),Y(t),t.loadVideoById(g,parseFloat(v))},onError:function(e){console.log("bonsai youtube error: "+e)},onStateChange:function(e){switch(e.data){case x:console.log("bonsai: "+m(k.getPlayerState()));break;case j:console.log("bonsai: "+m(k.getPlayerState())+" "+k.getCurrentTime());break;case h:S?A?console.log("bonsai: while readying -> play"):(B?console.log("bonsai: playing after buffer"):console.log("bonsai: playing"),V("PLAYING")):k.pauseVideo(),B&&U(!1);break;case p:S?B?A&&!D?(console.log("bonsai: ready (pause after buffer)"),L(!0),I(!1),V("READY")):(console.log("bonsai: paused after buffering"),V("PAUSED")):A?console.log("bonsai: while readying -> paused"):(console.log("bonsai: paused"),V("PAUSED")):(console.log("bonsai: init complete"),k.seekTo(v,!0),k.unMute(),E(!0),L(!0),I(!1),V("READY")),B&&U(!1);break;case f:A?console.log("bonsai: while readying -> buffering"):console.log("bonsai: buffering"),U(!0);break;case b:console.log("bonsai: "+m(k.getPlayerState())),V("ENDED");break;default:console.log("bonsai error: did not handle state change "+e.data)}}})]})},g=n(39),v=n(48),w=n(165),y=n(76);var k=function(){var e=Object(v.useSpring)((function(){return{x:0,y:0,config:{mass:1,tension:400,friction:5}}})),t=Object(d.a)(e,2),n=t[0],o=n.x,s=n.y,a=t[1],r=Object(y.a)((function(e){var t=e.down,n=Object(d.a)(e.movement,2),c=n[0],o=n[1];a({x:t?c:0,y:t?o:0})}));return Object(c.jsx)("div",{className:"h-screen w-full flex flex-wrap content-center justify-center",children:Object(c.jsx)(w.animated.div,Object(g.a)(Object(g.a)({},r()),{},{className:"bg-red-400 h-10 w-10 rounded-lg",style:{x:o,y:s}}))})},_=n(78),C=n.n(_),N=function(){var e={url:"https://www.twitch.tv/hamletva",width:window.innerWidth,height:window.innerHeight};return Object(c.jsx)(C.a,Object(g.a)(Object(g.a)({},e),{},{onProgress:function(e){var t=e.played,n=e.loaded,c=e.playedSeconds,o=e.loadedSeconds;console.log(t,n,c,o)}}))},S=(n(119),n(32)),E=n(42),M=n.n(E),T=n.p+"static/media/door-open.d2c81c6b.svg",D=n.p+"static/media/link.e557aaf1.svg",L=n(14),J=n(16),H=n(5),A=n(38),I=s.a.createContext(),P=function(){return Object(o.useContext)(I)},R=new(function(){function e(){Object(L.a)(this,e),this.ip_address=null,this.port=null,this.network_state=null,this.loading_room_code=!1,this._refresh_room_code_handler=null,this._room_code=null,Object(H.f)(this)}return Object(J.a)(e,[{key:"refreshRoomCode",value:function(){var e=this;M()({method:"post",url:"https://api.desk.link"+"/rooms/".concat(R.room_code,"/refresh")}).then((function(e){console.log("refresh "+R.room_code)})).catch((function(t){console.log(t),e.room_code=null}))}},{key:"room_code",get:function(){return this._room_code},set:function(e){this._room_code=e,e?this._refresh_room_code_handler=setInterval(this.refreshRoomCode,1e3):(clearInterval(this._refresh_room_code_handler),this._refresh_room_code_handler=null)}}]),e}());Object.seal(R);var B=Object(H.b)((function(e){e.forEach((function(e){R[e.Key]=e.Val}))})),U=Object(H.b)((function(e){for(var t in e)R[t]=e[t]}));var V=Object(A.a)((function(e){var t=e.children;return function(){var e=Object(o.useState)(!1),t=Object(d.a)(e,2),n=t[0],c=t[1];Object(o.useEffect)((function(){if(!n){c(!0);var e=function(e){var t=JSON.parse(e.data);switch(t.Type){case"command":switch(t.Message){case"pushStore":B(t.Data);break;default:console.log("message not handled "+e.data)}break;default:console.log("command not handled "+e.data),console.log(t)}};null!=window.vuplex?(console.log("bonsai: vuplex is not null -> storeListeners"),window.vuplex.addEventListener("message",e)):(console.log("bonsai: vuplex is null"),window.addEventListener("vuplexready",(function(t){console.log("bonsai: vuplexready -> storeListeners"),window.vuplex.addEventListener("message",e)})))}}),[n])}(),Object(c.jsx)(I.Provider,{value:{store:R,pushStore:U,pushStoreList:B},children:t})})),W=n(55),Y="https://api.desk.link",F="py-4 px-8 font-bold bg-red-800 active:bg-red-700 hover:bg-red-600 rounded cursor-pointer flex flex-wrap content-center";function z(){Object(S.postJson)({Type:"command",Message:"leaveRoom"})}function G(){Object(S.postJson)({Type:"command",Message:"kickAll"})}function q(){Object(S.postJson)({Type:"event",Message:"mouseDown"})}function K(){Object(S.postJson)({Type:"event",Message:"mouseUp"})}function Q(){Object(S.postJson)({Type:"event",Message:"hover"})}function X(e){return Object(c.jsx)("div",{onMouseDown:q,onMouseUp:K,onMouseEnter:Q,children:e.children})}function Z(e){var t=e.selected,n=e.handleClick,o=t?"rounded bg-blue-700 text-white px-3 py-2 cursor-pointer":"rounded hover:bg-gray-800 active:bg-gray-900 hover:text-white px-3 py-2 cursor-pointer";return Object(c.jsx)(X,{children:Object(c.jsx)("div",{className:o,onClick:n,children:e.children})})}function $(e){return Object(c.jsx)("div",{className:"space-y-1 px-2 h-full overflow-auto",children:e.children})}function ee(e){return Object(c.jsx)("div",{className:"text-white font-bold text-xl px-5 pt-5 pb-2",children:e.children})}function te(e){var t=e.handleClick,n=e.char;return Object(c.jsx)(X,{children:Object(c.jsx)("div",{onClick:function(){t(n)},className:"bg-gray-800 active:bg-gray-700 hover:bg-gray-600 rounded-full p-4 cursor-pointer w-20 h-20 flex flex-wrap content-center",children:Object(c.jsx)("span",{className:"w-full text-center",children:n})})})}function ne(e){return Object(c.jsxs)("div",{className:"flex w-full justify-between",children:[Object(c.jsxs)("div",{className:"flex w-auto",children:[Object(c.jsx)("div",{className:"flex flex-wrap content-center  p-2 mr-2",children:Object(c.jsx)("img",{className:"h-9 w-9",src:e.imgSrc,alt:""})}),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{className:"text-xl",children:e.title}),Object(c.jsx)("div",{className:"text-gray-400",children:e.slug})]})]}),e.children]})}function ce(e){var t=e.name;return Object(c.jsxs)("div",{className:"text-white p-4 h-full pr-8",children:[t?Object(c.jsx)("div",{className:"pb-8 text-xl",children:t}):"",Object(c.jsx)("div",{className:"space-y-8",children:e.children})]})}var oe=function(){return Object(c.jsx)("div",{className:"flex",children:Object(c.jsx)(ne,{title:"Connected",slug:"You are connected to a host",imgSrc:D,children:Object(c.jsx)(X,{children:Object(c.jsx)("div",{onClick:z,className:F,children:"exit"})})})})},se=Object(A.a)((function(){var e=P(),t=e.store,n=e.pushStore;return Object(c.jsxs)(s.a.Fragment,{children:[Object(c.jsx)(ne,{title:"Desk Code",slug:"People who have this can join you",imgSrc:T,children:Object(c.jsx)("div",{className:"text-4xl flex flex-wrap content-center",children:t.room_code?Object(c.jsx)(X,{children:Object(c.jsx)("div",{onClick:function(){n({room_code:null})},className:"px-2 py-1 bg-gray-800 active:bg-gray-700 hover:bg-gray-600 rounded cursor-pointer flex flex-wrap content-center",children:t.room_code})}):Object(c.jsx)(W.BounceLoader,{size:40,color:"#737373"})})}),"Hosting"===t.network_state?Object(c.jsx)(ne,{title:"Clients connected",slug:"There are people in your room",imgSrc:D,children:Object(c.jsx)(X,{children:Object(c.jsx)("div",{onClick:G,className:F,children:"kick all"})})}):""]})})),ae=function(){return Object(c.jsx)("div",{className:"flex justify-center w-full h-full",children:Object(c.jsx)(W.BounceLoader,{size:200,color:"#737373"})})};var re=[{name:"Home",component:Object(A.a)((function(){var e;switch(P().store.network_state){case"Neutral":case"HostWaiting":case"Hosting":e=Object(c.jsx)(se,{});break;case"ClientConnected":e=Object(c.jsx)(oe,{});break;default:e=Object(c.jsx)(ae,{})}return Object(c.jsx)(ce,{name:"Home",children:e})}))},{name:"Join Desk",component:function(e){var t=e.navHome,n=Object(o.useState)(""),s=Object(d.a)(n,2),a=s[0],r=s[1],i=Object(o.useState)(!1),l=Object(d.a)(i,2),u=l[0],j=l[1],b=Object(o.useState)(""),h=Object(d.a)(b,2),p=h[0],f=h[1];function x(e){switch(f(""),a.length){case 4:r(e);break;default:r(a+e)}}return Object(o.useEffect)((function(){if(!u&&4===a.length){var e=Y+"/rooms/".concat(a);console.log(e),M()({method:"get",url:e}).then((function(e){var n;n=e.data,Object(S.postJson)({Type:"command",Message:"joinRoom",data:JSON.stringify(n)}),t(),r(""),j(!1)})).catch((function(e){console.log(e),r(""),j(!1),f("Could not find room, try again")}))}}),[u,a]),Object(c.jsx)(ce,{name:"Join Desk",children:Object(c.jsxs)("div",{className:"flex flex-wrap w-full content-center",children:[Object(c.jsxs)("div",{className:" w-1/2",children:[Object(c.jsx)("div",{className:"text-xl",children:p}),Object(c.jsx)("div",{className:"text-9xl h-full flex flex-wrap content-center justify-center",children:a})]}),Object(c.jsxs)("div",{className:"p-2 rounded space-y-4 text-2xl",children:[Object(c.jsxs)("div",{className:"flex space-x-4",children:[Object(c.jsx)(te,{handleClick:x,char:"L"}),Object(c.jsx)(te,{handleClick:x,char:"R"}),Object(c.jsx)(te,{handleClick:x,char:"C"})]}),Object(c.jsxs)("div",{className:"flex space-x-4",children:[Object(c.jsx)(te,{handleClick:x,char:"D"}),Object(c.jsx)(te,{handleClick:x,char:"E"}),Object(c.jsx)(te,{handleClick:x,char:"F"})]}),Object(c.jsxs)("div",{className:"flex space-x-4",children:[Object(c.jsx)(te,{handleClick:x,char:"G"}),Object(c.jsx)(te,{handleClick:x,char:"H"}),Object(c.jsx)(te,{handleClick:x,char:"I"})]}),Object(c.jsx)("div",{className:"flex flex-wrap w-full justify-around",children:Object(c.jsx)(te,{handleClick:function(){a.length>0&&r(a.slice(0,a.length-1))},char:"<"})})]})]})})}},{name:"Contacts",component:function(){return Object(c.jsx)(ce,{name:"Contacts"})}},{name:"Settings",component:Object(A.a)((function(){var e=P().store,t="bg-gray-800 active:bg-gray-700 hover:bg-gray-600 rounded p-4 cursor-pointer flex flex-wrap content-center",n=Object(H.b)((function(e){e.ip_address=1234,e.port=4321})),o=Object(H.b)((function(e){e.ip_address=null,e.port=null})),s=Object(H.b)((function(e,t){e.network_state=t}));return Object(c.jsxs)(ce,{name:"Settings",children:[Object(c.jsxs)("div",{className:"flex space-x-2",children:[Object(c.jsx)(X,{children:Object(c.jsx)("div",{onClick:function(){s(e,"Neutral")},className:t,children:"Neutral"})}),Object(c.jsx)(X,{children:Object(c.jsx)("div",{onClick:function(){s(e,"HostWaiting")},className:t,children:"HostWaiting"})}),Object(c.jsx)(X,{children:Object(c.jsx)("div",{onClick:function(){s(e,"Hosting")},className:t,children:"Hosting"})}),Object(c.jsx)(X,{children:Object(c.jsx)("div",{onClick:function(){s(e,"ClientConnected")},className:t,children:"ClientConnected"})})]}),Object(c.jsxs)("div",{className:"flex space-x-2",children:[Object(c.jsx)(X,{children:Object(c.jsx)("div",{className:t,onClick:function(){n(e)},children:"+ fake ip/port"})}),Object(c.jsx)(X,{children:Object(c.jsx)("div",{className:t,onClick:function(){o(e)},children:"- fake ip/port"})})]}),Object(c.jsx)("ul",{children:Object.entries(e).map((function(e){return Object(c.jsxs)("li",{children:[e[0],": ",e[1]]},e[0])}))})]})}))}],ie=function(){var e=P(),t=e.store,n=e.pushStore,s=Object(o.useState)(0),a=Object(d.a)(s,2),r=a[0],i=a[1],l=re[r].component;return Object(o.useEffect)((function(){Object(H.c)((function(){if(t.room_code&&(!t.ip_address||!t.port))return console.log("rm room code"),void n({room_code:null});if(!t.room_code&&!t.loading_room_code&&t.ip_address&&t.port){console.log("fetch room code"),n({loading_room_code:!0});M()({method:"post",url:"https://api.desk.link/rooms",data:"ip_address=".concat(t.ip_address,"&port=").concat(t.port),header:{"content-type":"application/x-www-form-urlencoded"}}).then((function(e){n({room_code:e.data.tag,loading_room_code:!1})})).catch((function(e){console.log(e),n({loading_room_code:!1})}))}}))})),Object(o.useEffect)((function(){return function(){n({room_code:null})}}),[n]),Object(c.jsxs)("div",{className:"flex text-lg text-gray-500 h-full",children:[Object(c.jsxs)("div",{className:"w-4/12 bg-black h-full overflow-hidden",children:[Object(c.jsx)(ee,{children:"Menu"}),Object(c.jsx)($,{children:re.map((function(e,t){return Object(c.jsx)(Z,{handleClick:function(){i(t)},selected:r===t,children:e.name},e.name)}))})]}),Object(c.jsx)("div",{className:"w-full",children:Object(c.jsx)(l,{navHome:function(){i(0)}})})]})};function le(){console.log("Boot");var e=Object(i.g)(),t=function(e){return function(t){var n=JSON.parse(t.data);if("nav"===n.type)switch(n.command){case"push":console.log("command: nav "+n.path),e.push(n.path);break;default:console.log("command: not handled (navListeners) "+JSON.stringify(n))}}}(e);return null!=window.vuplex?(console.log("bonsai: vuplex is not null -> navListeners"),window.vuplex.addEventListener("message",t)):(console.log("bonsai: vuplex is null"),window.addEventListener("vuplexready",(function(e){console.log("bonsai: vuplexready -> navListeners"),window.vuplex.addEventListener("message",t)}))),Object(c.jsxs)("div",{children:["Boot",Object(c.jsxs)("ul",{children:[Object(c.jsx)("li",{children:Object(c.jsx)(l.a,{to:"/youtube_test/qEfPBt9dU60/19.02890180001912?x=480&y=360",children:"youtube_test video"})}),Object(c.jsx)("li",{children:Object(c.jsx)(l.a,{to:"/spring",children:"spring"})}),Object(c.jsx)("li",{children:Object(c.jsx)(l.a,{to:"/twitch",children:"twitch"})}),Object(c.jsx)("li",{onClick:function(){e.push("/menu")},className:"text-white",children:"menu"}),Object(c.jsx)("li",{children:Object(c.jsx)(l.a,{to:"/menu",children:"menu"})})]})]})}function de(){return Object(c.jsx)("div",{children:"home"})}var ue=function(){return console.log("App"),Object(c.jsx)(i.a,{children:Object(c.jsx)("div",{className:"bg-gray-900 h-screen text-green-400 select-none",children:Object(c.jsxs)(i.d,{children:[Object(c.jsx)(i.b,{path:"/home",component:de}),Object(c.jsx)(i.b,{path:"/spring",component:k}),Object(c.jsx)(i.b,{path:"/twitch",component:N}),Object(c.jsx)(i.b,{path:"/menu",component:ie}),Object(c.jsx)(i.b,{path:"/youtube/:id/:timeStamp",component:O}),Object(c.jsx)(i.b,{path:"/youtube_test/:id/:timeStamp",component:O}),Object(c.jsx)(i.b,{path:"/",component:le})]})})})};r.a.render(Object(c.jsx)(s.a.StrictMode,{children:Object(c.jsx)(V,{children:Object(c.jsx)(ue,{})})}),document.getElementById("root"))},32:function(e,t){e.exports={postJson:function(e){null!=window.vuplex&&window.vuplex.postMessage(e)}}},87:function(e,t,n){}},[[163,1,2]]]);
//# sourceMappingURL=main.6623c62c.chunk.js.map