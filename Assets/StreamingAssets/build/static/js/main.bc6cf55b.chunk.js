(this["webpackJsonpbonsai-gui"]=this["webpackJsonpbonsai-gui"]||[]).push([[0],{118:function(e,n,t){},162:function(e,n,t){"use strict";t.r(n);var o=t(2),c=t(0),s=t.n(c),a=t(34),i=t.n(a),r=(t(86),t(11)),l=t(38),d=t(7),u=t(71),j=-1,b=0,h=1,p=2,f=3,x=5,m=function(e){var n;switch(e){case-1:n="unstarted";break;case 0:n="ended";break;case 1:n="playing";break;case 2:n="paused";break;case 3:n="buffering";break;case 5:n="cued";break;default:n="BAD SWITCH STATE"}return n},g=function(e){var n=new URLSearchParams(e.location.search),t=parseInt(n.get("x")),s=parseInt(n.get("y")),a={width:t&&s?t:window.innerWidth,height:t&&s?s:window.innerHeight,playerVars:{autoplay:0,controls:0,disablekb:1,rel:0}},i=Object(r.g)(),l="youtube_test"===e.location.pathname.split("/")[1],g=e.match.params,O=g.id,v=g.timeStamp,w=Object(c.useState)(null),y=Object(d.a)(w,2),k=y[0],_=y[1],N=Object(c.useState)(!1),C=Object(d.a)(N,2),S=C[0],M=C[1],D=Object(c.useState)(!1),E=Object(d.a)(D,2),T=E[0],J=E[1],L=Object(c.useState)(!1),R=Object(d.a)(L,2),I=R[0],H=R[1],P=Object(c.useState)(!1),A=Object(d.a)(P,2),U=A[0],V=A[1],B=Object(c.useCallback)((function(e){"READY"!==e&&J(!1),console.log("POST "+e),l||window.vuplex.postMessage({type:"stateChange",message:e,current_time:k.getCurrentTime()})}),[k,l]),Y=Object(c.useCallback)((function(e){if(null!=k){if(T&&Math.abs(k.getCurrentTime()-e)<.01)return console.log("bonsai: ready-up called while ready"),void B("READY");var n=k.getPlayerState();S?(console.log("bonsai: readying up from "+m(n)+" -> "+e),F(k),n===p&&k.playVideo(),k.seekTo(e,!0),k.pauseVideo(),k.unMute()):console.log("bonsai: ignoring attempt to ready-up before init")}else console.log("bonsai: ignoring attempt to ready up while player is null")}),[S,k,B,T]),F=function(e){console.log("bonsai: prepare to ready up"),J(!1),H(!0),e.mute()};Object(c.useEffect)((function(){if(null!=k&&!l){var e=function(e){var n=JSON.parse(e.data);if("video"===n.type)switch(console.log(e.data),n.command){case"play":console.log("COMMAND: play"),k.playVideo();break;case"pause":console.log("COMMAND: pause"),k.pauseVideo();break;case"readyUp":console.log("COMMAND: readyUp"),Y(n.timeStamp);break;default:console.log("command: not handled (video) "+e.data)}};return window.vuplex.addEventListener("message",e),function(){window.vuplex.removeEventListener("message",e)}}}),[O,k,l,Y]),Object(c.useEffect)((function(){console.log("bonsai: add ping interval");var e=setInterval((function(){var e=0;null!=k&&null!=k.getCurrentTime()&&(e=k.getCurrentTime()),l||window.vuplex.postMessage({type:"infoCurrentTime",current_time:e})}),100);return function(){console.log("bonsai: remove ping interval"),clearInterval(e)}}),[O,k,l]);return Object(o.jsxs)("div",{children:[l?Object(o.jsxs)("div",{children:[Object(o.jsx)("p",{onClick:function(){i.push("/home")},children:"home"})," ",Object(o.jsx)("p",{onClick:function(){Y(40)},children:"ready up"})]}):"",Object(o.jsx)(u.a,{opts:a,onReady:function(e){var n=e.target;_(n),F(n),n.loadVideoById(O,parseFloat(v))},onError:function(e){console.log("bonsai youtube error: "+e)},onStateChange:function(e){switch(e.data){case x:console.log("bonsai: "+m(k.getPlayerState()));break;case j:console.log("bonsai: "+m(k.getPlayerState())+" "+k.getCurrentTime());break;case h:S?I?console.log("bonsai: while readying -> play"):(U?console.log("bonsai: playing after buffer"):console.log("bonsai: playing"),B("PLAYING")):k.pauseVideo(),U&&V(!1);break;case p:S?U?I&&!T?(console.log("bonsai: ready (pause after buffer)"),J(!0),H(!1),B("READY")):(console.log("bonsai: paused after buffering"),B("PAUSED")):I?console.log("bonsai: while readying -> paused"):(console.log("bonsai: paused"),B("PAUSED")):(console.log("bonsai: init complete"),k.seekTo(v,!0),k.unMute(),M(!0),J(!0),H(!1),B("READY")),U&&V(!1);break;case f:I?console.log("bonsai: while readying -> buffering"):console.log("bonsai: buffering"),V(!0);break;case b:console.log("bonsai: "+m(k.getPlayerState())),B("ENDED");break;default:console.log("bonsai error: did not handle state change "+e.data)}}})]})},O=t(39),v=t(49),w=t(164),y=t(75);var k=function(){var e=Object(v.useSpring)((function(){return{x:0,y:0,config:{mass:1,tension:400,friction:5}}})),n=Object(d.a)(e,2),t=n[0],c=t.x,s=t.y,a=n[1],i=Object(y.a)((function(e){var n=e.down,t=Object(d.a)(e.movement,2),o=t[0],c=t[1];a({x:n?o:0,y:n?c:0})}));return Object(o.jsx)("div",{className:"h-screen w-full flex flex-wrap content-center justify-center",children:Object(o.jsx)(w.animated.div,Object(O.a)(Object(O.a)({},i()),{},{className:"bg-red-400 h-10 w-10 rounded-lg",style:{x:c,y:s}}))})},_=t(77),N=t.n(_),C=function(){var e={url:"https://www.twitch.tv/hamletva",width:window.innerWidth,height:window.innerHeight};return Object(o.jsx)(N.a,Object(O.a)(Object(O.a)({},e),{},{onProgress:function(e){var n=e.played,t=e.loaded,o=e.playedSeconds,c=e.loadedSeconds;console.log(n,t,o,c)}}))},S=(t(118),t(28)),M=t(42),D=t.n(M),E=t.p+"static/media/door-open.d2c81c6b.svg",T=t.p+"static/media/link.e557aaf1.svg",J=t.p+"static/media/thinking-face.179ede86.svg",L=t(14),R=t(16),I=t(5),H=t(32),P=s.a.createContext(),A=function(){return Object(c.useContext)(P)},U=new(function(){function e(){Object(L.a)(this,e),this.ip_address=null,this.port=null,this.network_state=null,this.loading_room_code=!1,this._refresh_room_code_handler=null,this.player_info=[],this._room_open=!1,this._room_code=null,Object(I.f)(this)}return Object(R.a)(e,[{key:"refreshRoomCode",value:function(){var e=this;D()({method:"post",url:"https://api.desk.link"+"/rooms/".concat(U.room_code,"/refresh")}).then((function(e){})).catch((function(n){console.log(n),e.room_code=null}))}},{key:"room_open",get:function(){return this._room_open},set:function(e){this._room_open=e,e||(this.room_code="")}},{key:"room_code",get:function(){return this._room_code},set:function(e){var n=this;this._room_code=e,e?this._refresh_room_code_handler=setInterval((function(){n.room_code&&n.refreshRoomCode()}),1e3):(clearInterval(this._refresh_room_code_handler),this._refresh_room_code_handler=null)}}]),e}());Object.seal(U);var V=Object(I.b)((function(e){e.forEach((function(e){U[e.Key]=e.Val}))})),B=Object(I.b)((function(e){for(var n in e)U[n]=e[n]})),Y=Object(I.b)((function(e){U[e.Key]=e.Val}));var F=Object(H.a)((function(e){var n=e.children;return function(){var e=Object(c.useState)(!1),n=Object(d.a)(e,2),t=n[0],o=n[1];Object(c.useEffect)((function(){if(!t){o(!0);var e=function(e){var n=JSON.parse(e.data);switch(n.Type){case"command":switch(n.Message){case"pushStore":V(n.Data);break;case"pushStoreSingle":Y(n.Data);break;default:console.log("message not handled "+e.data)}break;default:console.log("command not handled "+e.data),console.log(n)}};null!=window.vuplex?(console.log("bonsai: vuplex is not null -> storeListeners"),window.vuplex.addEventListener("message",e)):(console.log("bonsai: vuplex is null"),window.addEventListener("vuplexready",(function(n){console.log("bonsai: vuplexready -> storeListeners"),window.vuplex.addEventListener("message",e)})))}}),[t])}(),Object(o.jsx)(P.Provider,{value:{store:U,pushStore:B,pushStoreList:V},children:n})})),W=t(55),z="https://api.desk.link",K="py-4 px-8 font-bold bg-red-800 active:bg-red-700 hover:bg-red-600 rounded cursor-pointer flex flex-wrap content-center",G="py-4 px-8 font-bold bg-gray-800 active:bg-gray-700 hover:bg-gray-600 rounded cursor-pointer flex flex-wrap content-center";function q(){Object(S.postJson)({Type:"command",Message:"openRoom"})}function Q(){Object(S.postJson)({Type:"command",Message:"closeRoom"})}function X(){Object(S.postJson)({Type:"command",Message:"leaveRoom"})}function Z(){Object(S.postJson)({Type:"event",Message:"mouseDown"})}function $(){Object(S.postJson)({Type:"event",Message:"mouseUp"})}function ee(){Object(S.postJson)({Type:"event",Message:"hover"})}function ne(e){return Object(o.jsx)("div",{onMouseDown:Z,onMouseUp:$,onMouseEnter:ee,children:e.children})}function te(e){var n=e.selected,t=e.handleClick,c=n?"py-4 px-8 bg-blue-700 text-white rounded cursor-pointer flex flex-wrap content-center":"py-4 px-8 hover:bg-gray-800 active:bg-gray-900 hover:text-white rounded cursor-pointer flex flex-wrap content-center";return Object(o.jsx)(ne,{children:Object(o.jsx)("div",{className:c,onClick:t,children:e.children})})}function oe(e){return Object(o.jsx)("div",{className:"space-y-1 px-2",children:e.children})}function ce(e){return Object(o.jsx)("div",{className:"text-white font-bold text-xl px-5 pt-5 pb-2",children:e.children})}function se(e){var n=e.handleClick,t=e.char,c=e.triggerMouseDown,s=void 0!==c&&c;return Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onMouseDown:function(){s&&n(t)},onMouseUp:function(){s||n(t)},className:"bg-gray-800 active:bg-gray-700 hover:bg-gray-600 rounded-full p-4 cursor-pointer w-20 h-20 flex flex-wrap content-center",children:Object(o.jsx)("span",{className:"w-full text-center",children:t})})})}function ae(e){var n=e.info,t=n.Name,c=n.ConnectionId;return 0===c?Object(o.jsx)(ie,{title:"You",slug:"".concat(c),imgSrc:J}):Object(o.jsx)(ie,{title:t,slug:c,imgSrc:J,children:Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:function(){var e;e=c,Object(S.postJson)({Type:"command",Message:"kickConnectionId",Data:e})},className:K,children:"Kick"})})})}function ie(e){return Object(o.jsxs)("div",{className:"flex w-full justify-between",children:[Object(o.jsxs)("div",{className:"flex w-auto",children:[Object(o.jsx)("div",{className:"flex flex-wrap content-center  p-2 mr-2",children:Object(o.jsx)("img",{className:"h-9 w-9",src:e.imgSrc,alt:""})}),Object(o.jsxs)("div",{className:"my-auto",children:[Object(o.jsx)("div",{className:"text-xl",children:e.title}),Object(o.jsx)("div",{className:"text-gray-400",children:e.slug})]})]}),e.children]})}function re(e){var n=e.name;return Object(o.jsxs)("div",{className:"text-white p-4 h-full pr-8",children:[n?Object(o.jsx)("div",{className:"pb-8 text-xl",children:n}):"",Object(o.jsx)("div",{className:"space-y-8",children:e.children})]})}var le=function(){return Object(o.jsx)("div",{className:"flex",children:Object(o.jsx)(ie,{title:"Connected",slug:"You are connected to a host",imgSrc:T,children:Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:X,className:K,children:"Exit"})})})})},de=Object(H.a)((function(){var e=A().store,n=Object(o.jsx)(ie,{title:"Room",slug:"Invite others",imgSrc:E,children:Object(o.jsx)(ne,{children:Object(o.jsx)("div",{className:"py-4 px-8 font-bold bg-green-800 active:bg-green-700 hover:bg-green-600 rounded cursor-pointer flex flex-wrap content-center",onClick:q,children:"Open Up"})})}),t=Object(o.jsx)(ie,{title:"Room",slug:"Ready to accept connections",imgSrc:E,children:Object(o.jsx)(ne,{children:Object(o.jsx)("div",{className:K,onClick:Q,children:"Close"})})});return e.room_open?Object(o.jsxs)(s.a.Fragment,{children:[t,Object(o.jsx)(ie,{title:"Desk Code",slug:"People who have this can join you",imgSrc:T,children:Object(o.jsx)("div",{className:"h-20 flex flex-wrap content-center",children:e.room_code?Object(o.jsx)("div",{className:"text-5xl ",children:e.room_code}):Object(o.jsx)("div",{className:"py-4 px-8 font-bold bg-gray-800 rounded flex flex-wrap content-center",children:Object(o.jsx)(W.BeatLoader,{size:8,color:"#737373"})})})})]}):Object(o.jsx)(s.a.Fragment,{children:n})})),ue=Object(H.a)((function(){var e=A().store;return Object(o.jsxs)(s.a.Fragment,{children:[Object(o.jsx)(de,{}),e.player_info.length>0&&e.room_open?Object(o.jsxs)(s.a.Fragment,{children:[Object(o.jsx)("div",{className:"text-xl",children:"People in Your Room"}),e.player_info.map((function(e){return Object(o.jsx)(ae,{info:e})}))]}):""]})})),je=function(){return Object(o.jsx)("div",{className:"flex justify-center w-full flex-wrap",children:Object(o.jsx)(W.BounceLoader,{size:200,color:"#737373"})})};var be=[{name:"Home",component:Object(H.a)((function(){var e;switch(A().store.network_state){case"Neutral":case"HostWaiting":case"Hosting":e=Object(o.jsx)(ue,{});break;case"ClientConnected":e=Object(o.jsx)(le,{});break;default:e=Object(o.jsx)(je,{})}return Object(o.jsx)(re,{name:"Home",children:e})}))},{name:"Join Desk",component:function(e){var n=e.navHome,t=Object(c.useState)(""),s=Object(d.a)(t,2),a=s[0],i=s[1],r=Object(c.useState)(!1),l=Object(d.a)(r,2),u=l[0],j=l[1],b=Object(c.useState)(""),h=Object(d.a)(b,2),p=h[0],f=h[1];function x(e){switch(console.log("handleclick"),f(""),a.length){case 4:i(e);break;default:i(a+e)}}return Object(c.useEffect)((function(){if(!u&&4===a.length){var e=z+"/rooms/".concat(a);console.log(e),D()({method:"get",url:e}).then((function(e){var t;t=e.data,Object(S.postJson)({Type:"command",Message:"joinRoom",data:JSON.stringify(t)}),n(),i(""),j(!1)})).catch((function(e){console.log(e),f("Could not find ".concat(a," try again")),i(""),j(!1)}))}}),[u,a,n]),Object(o.jsx)(re,{name:"Join Desk",children:Object(o.jsxs)("div",{className:"flex flex-wrap w-full content-center",children:[Object(o.jsxs)("div",{className:" w-1/2",children:[Object(o.jsx)("div",{className:"text-xl",children:p}),Object(o.jsx)("div",{className:"text-9xl h-full flex flex-wrap content-center justify-center",children:a.length<4?a:""})]}),Object(o.jsxs)("div",{className:"p-2 rounded space-y-4 text-2xl",children:[Object(o.jsxs)("div",{className:"flex space-x-4",children:[Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"L"}),Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"R"}),Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"C"})]}),Object(o.jsxs)("div",{className:"flex space-x-4",children:[Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"D"}),Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"E"}),Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"F"})]}),Object(o.jsxs)("div",{className:"flex space-x-4",children:[Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"G"}),Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"H"}),Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:x,char:"I"})]}),Object(o.jsx)("div",{className:"flex flex-wrap w-full justify-around",children:Object(o.jsx)(se,{triggerMouseDown:!0,handleClick:function(){a.length>0&&i(a.slice(0,a.length-1))},char:"<"})})]})]})})}},{name:"Contacts",component:function(){return Object(o.jsx)(re,{name:"Contacts"})}},{name:"Settings",component:Object(H.a)((function(){var e=A().store,n=Object(I.b)((function(e){e.ip_address=1234,e.port=4321})),t=Object(I.b)((function(e){e.ip_address=null,e.port=null})),c=Object(I.b)((function(e,n){e.network_state=n})),s=Object(I.b)((function(e){e.player_info.length>0?e.player_info.push({Name:"cam",ConnectionId:1}):e.player_info.push({Name:"cam",ConnectionId:0})})),a=Object(I.b)((function(e){e.player_info.pop()})),i=Object(I.b)((function(e){e.room_open=!e.room_open}));return Object(o.jsxs)(re,{name:"Settings",children:[Object(o.jsxs)("div",{className:"flex space-x-2",children:[Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:function(){c(e,"Neutral")},className:G,children:"Neutral"})}),Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:function(){c(e,"HostWaiting")},className:G,children:"HostWaiting"})}),Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:function(){c(e,"Hosting")},className:G,children:"Hosting"})}),Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:function(){c(e,"ClientConnected")},className:G,children:"ClientConnected"})})]}),Object(o.jsxs)("div",{className:"flex space-x-2",children:[Object(o.jsx)(ne,{children:Object(o.jsx)("div",{className:G,onClick:function(){n(e)},children:"+ fake ip/port"})}),Object(o.jsx)(ne,{children:Object(o.jsx)("div",{className:G,onClick:function(){t(e)},children:"- fake ip/port"})}),Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:function(){s(e)},className:G,children:"+ fake client"})}),Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:function(){a(e)},className:G,children:"- fake client"})})]}),Object(o.jsx)(ne,{children:Object(o.jsx)("div",{onClick:function(){i(e)},className:G,children:"toggle room open"})}),Object(o.jsx)("div",{className:"flex space-x-2"}),Object(o.jsx)("ul",{children:Object.entries(e).map((function(e){return Object(o.jsxs)("li",{children:[e[0],": ",he(e)]},e[0])}))})]})}))}];function he(e){switch(e[0]){case"player_info":return"["+e[1].map((function(e){return"(".concat(e.Name,", ").concat(e.ConnectionId,")")})).join(" ")+"]";default:return e[1]?e[1].toString():""}}var pe=function(){var e=A(),n=e.store,t=e.pushStore,s=Object(c.useState)(0),a=Object(d.a)(s,2),i=a[0],r=a[1],l=be[i].component;return Object(c.useEffect)((function(){Object(I.c)((function(){if(n.room_code&&(!n.ip_address||!n.port||!n.room_open))return console.log("rm room code"),void t({room_code:null});if(n.room_open&&!n.room_code&&!n.loading_room_code&&n.ip_address&&n.port){console.log("fetch room code"),t({loading_room_code:!0});D()({method:"post",url:"https://api.desk.link/rooms",data:"ip_address=".concat(n.ip_address,"&port=").concat(n.port),header:{"content-type":"application/x-www-form-urlencoded"}}).then((function(e){t({room_code:e.data.tag,loading_room_code:!1})})).catch((function(e){console.log(e),t({loading_room_code:!1})}))}}))})),Object(c.useEffect)((function(){return function(){t({room_code:null})}}),[t]),Object(o.jsxs)("div",{className:"flex text-lg text-gray-500 h-full",children:[Object(o.jsxs)("div",{className:"w-4/12 bg-black overflow-auto scrollhost static",children:[Object(o.jsx)("div",{className:"w-4/12 bg-black fixed",children:Object(o.jsx)(ce,{children:"Menu"})}),Object(o.jsx)("div",{className:"h-16"}),Object(o.jsx)(oe,{children:be.map((function(e,n){return Object(o.jsx)(te,{handleClick:function(){r(n)},selected:i===n,children:e.name},e.name)}))})]}),Object(o.jsx)("div",{className:"bg-gray-900 z-10 w-full overflow-auto scrollhost",children:Object(o.jsx)(l,{navHome:function(){r(0)}})})]})};function fe(){Object(S.postJson)({Type:"event",Message:"listenersReady"})}function xe(){console.log("Boot");var e=Object(r.g)(),n=function(e){return function(n){var t=JSON.parse(n.data);if("nav"===t.type)switch(t.command){case"push":console.log("command: nav "+t.path),e.push(t.path);break;default:console.log("command: not handled (navListeners) "+JSON.stringify(t))}}}(e);return null!=window.vuplex?(console.log("bonsai: vuplex is not null -> navListeners"),window.vuplex.addEventListener("message",n),fe()):(console.log("bonsai: vuplex is null"),window.addEventListener("vuplexready",(function(e){console.log("bonsai: vuplexready -> navListeners"),window.vuplex.addEventListener("message",n),fe()}))),Object(o.jsxs)("div",{children:["Boot",Object(o.jsxs)("ul",{children:[Object(o.jsx)("li",{children:Object(o.jsx)(l.a,{to:"/youtube_test/qEfPBt9dU60/19.02890180001912?x=480&y=360",children:"youtube_test video"})}),Object(o.jsx)("li",{children:Object(o.jsx)(l.a,{to:"/spring",children:"spring"})}),Object(o.jsx)("li",{children:Object(o.jsx)(l.a,{to:"/twitch",children:"twitch"})}),Object(o.jsx)("li",{onClick:function(){e.push("/menu")},className:"text-white",children:"menu"}),Object(o.jsx)("li",{children:Object(o.jsx)(l.a,{to:"/menu",children:"menu"})})]})]})}function me(){return Object(o.jsx)("div",{children:"home"})}var ge=function(){return console.log("App"),Object(o.jsx)(r.a,{children:Object(o.jsx)("div",{className:"h-screen text-green-400 select-none",children:Object(o.jsxs)(r.d,{children:[Object(o.jsx)(r.b,{path:"/home",component:me}),Object(o.jsx)(r.b,{path:"/spring",component:k}),Object(o.jsx)(r.b,{path:"/twitch",component:C}),Object(o.jsx)(r.b,{path:"/menu",component:pe}),Object(o.jsx)(r.b,{path:"/youtube/:id/:timeStamp",component:g}),Object(o.jsx)(r.b,{path:"/youtube_test/:id/:timeStamp",component:g}),Object(o.jsx)(r.b,{path:"/",component:xe})]})})})};i.a.render(Object(o.jsx)(s.a.StrictMode,{children:Object(o.jsx)(F,{children:Object(o.jsx)(ge,{})})}),document.getElementById("root"))},28:function(e,n){e.exports={postJson:function(e){null!=window.vuplex&&window.vuplex.postMessage(e)}}},86:function(e,n,t){}},[[162,1,2]]]);
//# sourceMappingURL=main.bc6cf55b.chunk.js.map